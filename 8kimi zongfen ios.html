<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>å¤§å­¦äººç”Ÿæ¨¡æ‹Ÿå™¨ 2026 - iOSç‰ˆ</title>
<script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&family=Zcool+KuaiLe&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #0f172a; color: #e2e8f0; overflow-x: hidden; }
        .title-font { font-family: 'Zcool KuaiLe', cursive; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); }
        .stat-bar-bg { background: rgba(255, 255, 255, 0.1); border-radius: 9999px; height: 8px; overflow: hidden; }
        .stat-bar-fill { height: 100%; border-radius: 9999px; transition: width 0.5s ease; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        .major-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .major-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5); border-color: #3b82f6; }
        .major-card.selected { border-color: #10b981; background: rgba(16, 185, 129, 0.1); box-shadow: 0 0 20px rgba(16, 185, 129, 0.3); }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        .floating { animation: float 4s ease-in-out infinite; }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { to { opacity: 1; } }
        .choice-btn { transition: all 0.2s; }
        .choice-btn:hover { transform: scale(1.02); background-color: rgba(59, 130, 246, 0.2); }
        .timeline-item { position: relative; }
        .timeline-item.active { color: #10b981; font-weight: bold; }
        .timeline-item.active::after { content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); width: 8px; height: 8px; background: #10b981; border-radius: 50%; box-shadow: 0 0 10px #10b981; }
        .warning-pulse { animation: warningPulse 2s infinite; }
        @keyframes warningPulse { 0%, 100% { box-shadow: 0 0 5px rgba(239, 68, 68, 0.5); } 50% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.8); } }
        .summary-card { background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9)); border: 1px solid rgba(59, 130, 246, 0.3); }
    </style>
<base target="_blank">
<base target="_blank">
<base target="_blank">
</head>
<body class="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
    <div id="app-container" class="w-full max-w-6xl p-4 relative">
        <header class="text-center mb-8 floating">
            <h1 class="text-5xl md:text-6xl title-font text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500 mb-2 drop-shadow-lg">å¤§å­¦äººç”Ÿæ¨¡æ‹Ÿå™¨</h1>
            <p class="text-slate-400 text-lg">UNIVERSITY LIFE SIMULATOR - å®Œæ•´ç‰ˆ</p>
        </header>

        <div id="timeline-display" class="hidden mb-6 glass-panel rounded-xl p-4">
            <div class="flex justify-between items-center text-sm text-slate-400 overflow-x-auto">
                <div class="timeline-item active" data-sem="0">å¤§ä¸€ä¸Š</div><div class="h-px flex-grow bg-slate-600 mx-2"></div>
                <div class="timeline-item" data-sem="1">å¤§ä¸€ä¸‹</div><div class="h-px flex-grow bg-slate-600 mx-2"></div>
                <div class="timeline-item" data-sem="2">å¤§äºŒä¸Š</div><div class="h-px flex-grow bg-slate-600 mx-2"></div>
                <div class="timeline-item" data-sem="3">å¤§äºŒä¸‹</div><div class="h-px flex-grow bg-slate-600 mx-2"></div>
                <div class="timeline-item" data-sem="4">å¤§ä¸‰ä¸Š</div><div class="h-px flex-grow bg-slate-600 mx-2"></div>
                <div class="timeline-item" data-sem="5">å¤§ä¸‰ä¸‹</div><div class="h-px flex-grow bg-slate-600 mx-2"></div>
                <div class="timeline-item" data-sem="6">å¤§å››ä¸Š</div><div class="h-px flex-grow bg-slate-600 mx-2"></div>
                <div class="timeline-item" data-sem="7">å¤§å››ä¸‹</div>
            </div>
        </div>

        <div id="screen-creation" class="glass-panel rounded-2xl p-8 w-full">
            <h2 class="text-2xl font-bold mb-6 text-cyan-300 border-b border-slate-700 pb-2">è§’è‰²åˆ›å»º</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-purple-300">1. é€‰æ‹©ä½ çš„å­¦ç§‘é—¨ç±» (12ä¸ªå­¦ç§‘é—¨ç±»)</h3>
                    <div class="grid grid-cols-1 gap-3 max-h-96 overflow-y-auto pr-2" id="major-list"></div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-purple-300">2. åˆ†é…åˆå§‹å±æ€§ç‚¹ (å‰©ä½™: <span id="points-remaining" class="text-yellow-400">10</span>)</h3>
                    <p class="text-xs text-slate-400 mb-4">ä¸åŒå­¦ç§‘æœ‰åˆå§‹åŠ æˆï¼Œåˆ†é…å‰©ä½™ç‚¹æ•°ã€‚</p>
                    <div class="space-y-4" id="stats-container"></div>
                    <div class="mt-8 p-4 bg-slate-800/50 rounded-lg border border-slate-700">
                        <h4 class="font-bold text-white mb-2">å½“å‰çŠ¶æ€é¢„è§ˆ:</h4>
                        <div id="stat-preview-bars" class="space-y-2"></div>
                    </div>
                </div>
            </div>
            <div class="mt-8 flex justify-end">
                <button onclick="startGame()" class="px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold rounded-full shadow-lg transform transition hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed" id="start-btn">å¼€å§‹å¤§å­¦ç”Ÿæ´»</button>
            </div>
        </div>

        <div id="screen-gameplay" class="hidden glass-panel rounded-2xl p-1 w-full h-[85vh] flex flex-col md:flex-row overflow-hidden">
            <div class="w-full md:w-1/4 bg-slate-900/80 p-6 flex flex-col border-r border-slate-700 overflow-y-auto">
                <div class="mb-6 text-center">
                    <div class="inline-block p-3 rounded-full bg-slate-800 mb-2"><span id="game-avatar" class="text-4xl">ğŸ‘¨â€ğŸ“</span></div>
                    <h2 id="game-major-name" class="font-bold text-xl text-white">ä¸“ä¸šåç§°</h2>
                    <div class="text-sm text-cyan-400" id="game-semester-display">å¤§ä¸€ä¸Šå­¦æœŸ</div>
                    <div class="text-xs text-slate-400 mt-2" id="game-year-display">ç¬¬ 1 å¹´ / å…± 4 å¹´</div>
                </div>
                <div class="space-y-4 flex-grow"><div id="game-stats-display"></div><div id="status-warnings" class="space-y-2 mt-4"></div></div>
                <div class="mt-4 pt-4 border-t border-slate-700">
                    <button onclick="takeRest()" id="rest-btn" class="w-full py-2 text-xs bg-green-800 hover:bg-green-700 text-green-100 rounded border border-green-600 mb-2 hidden">ğŸ›Œ ç”³è¯·ä¼‘æ•´/è¯·å‡</button>
                    <button onclick="confirmDropout()" class="w-full py-2 text-xs bg-red-900/50 hover:bg-red-800 text-red-200 rounded border border-red-700">âš ï¸ ç”³è¯·ä¼‘å­¦/é€€å­¦</button>
                    <div class="text-xs text-slate-500 text-center mt-2">GPA: <span id="game-gpa" class="text-white font-mono">0.00</span></div>
                </div>
            </div>
            <div class="w-full md:w-3/4 p-6 md:p-10 flex flex-col relative overflow-y-auto" id="event-area">
                <div class="mb-6">
                    <span id="event-tag" class="px-3 py-1 rounded-full text-xs font-bold bg-blue-900 text-blue-200 border border-blue-700 mb-2 inline-block">å…¥å­¦å­£</span>
                    <h2 id="event-title" class="text-3xl font-bold text-white mb-2">æ¬¢è¿æ¥åˆ°å¤§å­¦æ ¡å›­</h2>
                    <div class="h-1 w-20 bg-purple-500 rounded"></div>
                </div>
                <div class="bg-slate-800/40 p-6 rounded-xl border-l-4 border-purple-500 mb-8 shadow-inner">
                    <p id="event-desc" class="text-lg leading-relaxed text-slate-200"></p>
                    <div id="event-flavor" class="mt-4 text-sm text-slate-400 italic"></div>
                </div>
                <div id="comparison-view" class="hidden mb-6 bg-slate-900/90 p-4 rounded-lg border border-slate-600">
                    <h4 class="text-sm font-bold text-yellow-400 mb-2">ğŸ“Š åˆ¤å®šç»“æœ</h4>
                    <div class="grid grid-cols-3 gap-2 text-xs text-center" id="comparison-grid"></div>
                </div>
                <div id="choices-container" class="grid grid-cols-1 gap-4"></div>
            </div>
        </div>

        <div id="screen-year-summary" class="hidden glass-panel rounded-2xl p-8 w-full">
            <h2 class="text-3xl title-font text-center text-white mb-2" id="summary-year-title">å­¦å¹´æ€»ç»“</h2>
            <p class="text-slate-400 text-center mb-8" id="summary-year-subtitle"></p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="summary-card p-6 rounded-xl"><h3 class="text-lg font-bold text-cyan-400 mb-4">ğŸ“Š å±æ€§å˜åŒ–</h3><div id="summary-stats-change" class="space-y-2 text-sm"></div></div>
                <div class="summary-card p-6 rounded-xl"><h3 class="text-lg font-bold text-purple-400 mb-4">â­ å…³é”®äº‹ä»¶</h3><div id="summary-key-events" class="space-y-2 text-sm max-h-48 overflow-y-auto"></div></div>
                <div class="summary-card p-6 rounded-xl"><h3 class="text-lg font-bold text-green-400 mb-4">ğŸ’¡ å‘å±•å»ºè®®</h3><div id="summary-advice" class="text-sm text-slate-300 leading-relaxed"></div></div>
            </div>
            <div class="text-center"><button onclick="nextYear()" class="px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold rounded-full hover:scale-105 transition">è¿›å…¥ä¸‹ä¸€å­¦å¹´ â”</button></div>
        </div>

        <div id="screen-ending" class="hidden glass-panel rounded-2xl p-8 w-full text-center">
            <h2 class="text-4xl title-font text-white mb-2">æ¯•ä¸šè¯„ä¼°æŠ¥å‘Š</h2>
            <p class="text-slate-400 mb-8">å››å¹´æ—¶å…‰è½¬ç¬å³é€...</p>
            <div class="bg-slate-900/50 rounded-xl p-8 max-w-4xl mx-auto border border-slate-700 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div><canvas id="radarChart" width="300" height="300"></canvas></div>
                    <div class="text-left space-y-4">
                        <h3 class="text-2xl font-bold text-cyan-400" id="end-title">å…¨èƒ½å­¦éœ¸</h3>
                        <p class="text-slate-300" id="end-desc">ä½ åœ¨å¤§å­¦æœŸé—´è¡¨ç°ä¼˜å¼‚ï¼Œå„é¡¹æŒ‡æ ‡å‡è¡¡å‘å±•ã€‚</p>
                        <div class="space-y-2 mt-4">
                            <div class="flex justify-between text-sm"><span>ä¸“æ³¨åº¦</span><span class="font-mono text-blue-400" id="end-focus">0</span></div>
                            <div class="flex justify-between text-sm"><span>ç‰¹é•¿</span><span class="font-mono text-purple-400" id="end-talent">0</span></div>
                            <div class="flex justify-between text-sm"><span>å¥åº·å€¼</span><span class="font-mono text-green-400" id="end-health">0</span></div>
                            <div class="flex justify-between text-sm"><span>ç¤¾äº¤åŠ›</span><span class="font-mono text-pink-400" id="end-social">0</span></div>
                            <div class="flex justify-between text-sm"><span>æŠ—å‹å€¼</span><span class="font-mono text-red-400" id="end-resistance">0</span></div>
                            <div class="h-px bg-slate-600 my-2"></div>
                            <div class="flex justify-between text-base font-bold"><span>ğŸ† å±æ€§æ€»å€¼</span><span class="font-mono text-yellow-400" id="end-total">0</span></div>
                            <div class="flex justify-between text-xs text-slate-400 mt-1"><span>ç»¼åˆè¯„çº§</span><span id="end-rating">-</span></div>
                        </div>
                        <div class="mt-6 p-4 bg-slate-800 rounded-lg"><h4 class="text-sm font-bold text-white mb-2">ğŸ¯ å¤§å­¦å››å¹´æ€»è¯„</h4><p class="text-sm text-slate-300" id="end-summary"></p></div>
                    </div>
                </div>
            </div>
            <div class="flex justify-center gap-4">
                <button onclick="exportLog()" class="px-8 py-3 bg-gradient-to-r from-green-600 to-teal-600 text-white font-bold rounded-full hover:scale-105 transition">ğŸ“„ å¯¼å‡ºæ“ä½œè®°å½•</button>
                <button onclick="location.reload()" class="px-8 py-3 bg-white text-slate-900 font-bold rounded-full hover:bg-slate-200 transition">é‡æ–°å¼€å§‹äººç”Ÿ</button>
            </div>
        </div>
    </div>

<script>
const STATS = {
    focus: { name: 'ä¸“æ³¨åº¦', color: 'bg-blue-500', desc: 'å½±å“å­¦ä¹ æ•ˆç‡', icon: 'ğŸ¯' },
    talent: { name: 'ç‰¹é•¿', color: 'bg-purple-500', desc: 'å½±å“ç«èµ›ä¸ç‰¹æ®Šäº‹ä»¶', icon: 'âœ¨' },
    health: { name: 'å¥åº·å€¼', color: 'bg-green-500', desc: 'å½±å“èº«ä½“çŠ¶æ€', icon: 'ğŸ’ª' },
    social: { name: 'ç¤¾äº¤åŠ›', color: 'bg-pink-500', desc: 'å½±å“ç¤¾å›¢ä¸äººé™…', icon: 'ğŸ‘¥' },
    resistance: { name: 'æŠ—å‹å€¼', color: 'bg-red-500', desc: 'æŠ—å‹èƒ½åŠ›ï¼Œå½’é›¶æ—¶å´©æºƒ', icon: 'ğŸ›¡ï¸' }
};

const MAJORS = [
    { id: 'philosophy', name: 'å“²å­¦', icon: 'ğŸ¤”', category: 'äººæ–‡ç¤¾ç§‘', desc: 'æ€è€ƒäººç”Ÿç»ˆæé—®é¢˜ï¼ŒåŸ¹å…»æ‰¹åˆ¤æ€§æ€ç»´ã€‚', baseStats: { focus: 2, talent: 1, health: 1, social: 0, resistance: 3 }, advantages: ['focus', 'resistance'] },
    { id: 'economics', name: 'ç»æµå­¦', icon: 'ğŸ“ˆ', category: 'ç¤¾ç§‘ç»ç®¡', desc: 'ç ”ç©¶èµ„æºé…ç½®ï¼Œå•†åœºå¦‚æˆ˜åœºã€‚', baseStats: { focus: 2, talent: 0, health: 0, social: 2, resistance: 3 }, advantages: ['social', 'focus'] },
    { id: 'law', name: 'æ³•å­¦', icon: 'âš–ï¸', category: 'ç¤¾ç§‘ç»ç®¡', desc: 'èƒŒè¯µå¤§é‡æ³•æ¡ï¼Œé€»è¾‘ä¸¥å¯†ã€‚', baseStats: { focus: 3, talent: 0, health: -1, social: 1, resistance: 4 }, advantages: ['focus', 'resistance'] },
    { id: 'education', name: 'æ•™è‚²å­¦', icon: 'ğŸ“š', category: 'æ•™è‚²è‰ºæœ¯', desc: 'æ•™ä¹¦è‚²äººï¼Œéœ€è¦æå¤§çš„è€å¿ƒã€‚', baseStats: { focus: 1, talent: 1, health: 1, social: 2, resistance: 3 }, advantages: ['social', 'health'] },
    { id: 'literature', name: 'æ–‡å­¦', icon: 'âœï¸', category: 'äººæ–‡ç¤¾ç§‘', desc: 'è…¹æœ‰è¯—ä¹¦æ°”è‡ªåï¼Œåˆ›ä½œéœ€è¦çµæ„Ÿã€‚', baseStats: { focus: 1, talent: 3, health: 1, social: 0, resistance: 3 }, advantages: ['talent', 'focus'] },
    { id: 'history', name: 'å†å²å­¦', icon: 'ğŸ›ï¸', category: 'äººæ–‡ç¤¾ç§‘', desc: 'åšå¤é€šä»Šï¼Œè€ƒå¤å‘æ˜éœ€è¦ä½“åŠ›ã€‚', baseStats: { focus: 3, talent: 1, health: 0, social: 0, resistance: 3 }, advantages: ['focus', 'talent'] },
    { id: 'science', name: 'ç†å­¦', icon: 'ğŸ”¬', category: 'ç†å·¥å†œåŒ»', desc: 'æ¢ç´¢è‡ªç„¶è§„å¾‹ï¼Œå®éªŒä¸ç†è®ºå¹¶é‡ã€‚', baseStats: { focus: 3, talent: 1, health: 0, social: -1, resistance: 4 }, advantages: ['focus', 'talent'] },
    { id: 'engineering', name: 'å·¥å­¦', icon: 'âš™ï¸', category: 'ç†å·¥å†œåŒ»', desc: 'å·¥ç¨‹å¸ˆçš„æ‘‡ç¯®ï¼ŒåŠ¨æ‰‹èƒ½åŠ›è‡³å…³é‡è¦ã€‚', baseStats: { focus: 2, talent: 2, health: 1, social: 0, resistance: 3 }, advantages: ['talent', 'focus'] },
    { id: 'agriculture', name: 'å†œå­¦', icon: 'ğŸŒ¾', category: 'ç†å·¥å†œåŒ»', desc: 'ä»ç”°é—´åˆ°å®éªŒå®¤ï¼Œè„šè¸å®åœ°ã€‚', baseStats: { focus: 2, talent: 0, health: 2, social: 0, resistance: 3 }, advantages: ['health', 'focus'] },
    { id: 'medicine', name: 'åŒ»å­¦', icon: 'ğŸ©º', category: 'ç†å·¥å†œåŒ»', desc: 'æ•‘æ­»æ‰¶ä¼¤ï¼Œå­¦ä¸šç¹é‡å‘¨æœŸæ¼«é•¿ã€‚', baseStats: { focus: 3, talent: 0, health: 0, social: 1, resistance: 4 }, advantages: ['focus', 'health'] },
    { id: 'arts', name: 'è‰ºæœ¯å­¦', icon: 'ğŸ¨', category: 'æ•™è‚²è‰ºæœ¯', desc: 'çµæ„Ÿä¸æŠ€è‰ºçš„ç»“åˆï¼Œè¡¨è¾¾è‡ªæˆ‘ã€‚', baseStats: { focus: 0, talent: 3, health: 1, social: 1, resistance: 3 }, advantages: ['talent', 'social'] },
    { id: 'management', name: 'ç®¡ç†å­¦', icon: 'ğŸ’¼', category: 'ç¤¾ç§‘ç»ç®¡', desc: 'åè°ƒèµ„æºï¼Œé¢†å¯¼åŠ›ä¸æ²Ÿé€šå¹¶é‡ã€‚', baseStats: { focus: 1, talent: 0, health: 0, social: 3, resistance: 3 }, advantages: ['social', 'resistance'] }
];

const EVENTS = {
    welcome: {
        id: 'welcome', semester: 0, title: 'åˆå…¥æ ¡å›­', tag: 'å…¥å­¦å­£', type: 'common',
        desc: 'é‡‘è‰²çš„ä¹æœˆï¼Œä½ æ‹–ç€è¡Œæç®±ç«™åœ¨æ ¡é—¨å£ã€‚æœªæ¥çš„å››å¹´å³å°†åœ¨è¿™é‡Œå±•å¼€ã€‚',
        flavor: 'çœ‹ç€ç†™ç†™æ”˜æ”˜çš„äººç¾¤ï¼Œä½ æ·±å¸ä¸€å£æ°”ï¼Œè¿ˆå‡ºäº†å¤§å­¦ç”Ÿæ¶¯çš„ç¬¬ä¸€æ­¥ã€‚',
        choices: [
            { text: 'ğŸ“š å»å›¾ä¹¦é¦†å åº§ï¼Œé¢„ä¹ è¯¾ç¨‹', effects: { focus: 1, resistance: -1, health: -1 } },
            { text: 'ğŸ‰ å‚åŠ ç¤¾å›¢æ‹›æ–°ï¼Œå¹¿äº¤æœ‹å‹', effects: { social: 2, resistance: 1, focus: -1 } },
            { text: 'ğŸ›Œ æ•´ç†å®¿èˆï¼Œæ—©ç‚¹ä¼‘æ¯', effects: { health: 2, resistance: 2 } },
            { text: 'ğŸ’» äº†è§£ä¸“ä¸šåŸ¹å…»æ–¹æ¡ˆ', effects: { focus: 2, talent: 1, resistance: -1 } }
        ]
    }
};

const MAJOR_EVENTS = {
    philosophy: [
        { id: 'philosophy_debate', title: 'è‹æ ¼æ‹‰åº•å¼è¯˜é—®', desc: 'è¯¾å ‚ä¸Šæ•™æˆå¯¹ä½ è¿›è¡Œè¿ç¯è¿½é—®ï¼Œå…³äº"æ­£ä¹‰"çš„æœ¬è´¨ã€‚', choices: [
            { text: 'è¿ç”¨é€»è¾‘è®ºè¯', effects: { focus: 2, resistance: -1 }, check: { stat: 'focus', val: 4, success: 'ä½ çš„è®ºè¯æ— æ‡ˆå¯å‡»ï¼Œè·å¾—åŠ åˆ†ã€‚', fail: 'è¢«é—®å¾—å“‘å£æ— è¨€ï¼Œåœºé¢å°´å°¬ã€‚' } },
            { text: 'å¼•ç”¨ç»å…¸å“²å­¦è§‚ç‚¹', effects: { talent: 2, focus: 1 }, check: { stat: 'talent', val: 3, success: 'æ—å¾åšå¼•ï¼Œå±•ç°æ·±åšç§¯ç´¯ã€‚', fail: 'å¼•ç”¨é”™è¯¯ï¼Œè¢«æ•™æˆçº æ­£ã€‚' } }
        ]},
        { id: 'existential_crisis', title: 'å­˜åœ¨ä¸»ä¹‰å±æœº', desc: 'æ·±å¤œæ€è€ƒäººç”Ÿæ„ä¹‰ï¼Œé™·å…¥è™šæ— ä¸»ä¹‰æ¼©æ¶¡ã€‚', choices: [
            { text: 'å‘å¯¼å¸ˆå¯»æ±‚æŒ‡å¼•', effects: { resistance: 2, focus: 1 } },
            { text: 'é€šè¿‡å†™ä½œè‡ªæˆ‘ç–—æ„ˆ', effects: { talent: 2, resistance: 1, health: -1 } },
            { text: 'æš‚æ—¶æ”¾ä¸‹ï¼Œè¿åŠ¨é‡Šæ”¾', effects: { health: 2, resistance: 1 } }
        ]}
    ],
    economics: [
        { id: 'stock_simulation', title: 'æ¨¡æ‹Ÿè‚¡å¸‚çˆ†ä»“', desc: 'æŠ•èµ„å­¦è¯¾ç¨‹æ¨¡æ‹Ÿç›˜ï¼Œä½ çš„ä»“ä½é­é‡è¿ç»­è·Œåœã€‚', choices: [
            { text: 'è¿½åŠ ä¿è¯é‡‘ï¼Œæ­»æ‰›åˆ°åº•', effects: { resistance: -2, talent: 1 }, check: { stat: 'talent', val: 3, success: 'å¥‡è¿¹èˆ¬åå¼¹ï¼Œæ‰­äºä¸ºç›ˆã€‚', fail: 'çˆ†ä»“å½’é›¶ï¼Œå¿ƒæ€å´©äº†ã€‚' } },
            { text: 'æœæ–­æ­¢æŸï¼Œåˆ†æåŸå› ', effects: { focus: 2, resistance: 1 } }
        ]},
        { id: 'case_competition', title: 'å•†ä¸šæ¡ˆä¾‹åˆ†æ', desc: 'åˆ†ææŸçŸ¥åä¼ä¸šçš„æˆ˜ç•¥è½¬å‹ï¼Œå‡†å¤‡è¯¾å ‚å±•ç¤ºã€‚', choices: [
            { text: 'å¸¦é¢†å›¢é˜Ÿç†¬å¤œæ‰“ç£¨', effects: { focus: 2, health: -2, resistance: -2 }, check: { stat: 'focus', val: 4, success: 'æ¡ˆä¾‹åˆ†æè·æ»¡åˆ†ï¼Œæˆä¸ºèŒƒæœ¬ã€‚', fail: 'ç–²åŠ³å¯¼è‡´æ¼æ´ç™¾å‡ºã€‚' } },
            { text: 'åˆç†åˆ†å·¥ï¼ŒæŒ‰éƒ¨å°±ç­', effects: { social: 2, focus: 1 } }
        ]}
    ],
    law: [
        { id: 'moot_court', title: 'æ¨¡æ‹Ÿæ³•åº­æ¿€è¾©', desc: 'ä½œä¸ºè¾©æŠ¤äººé¢å¯¹ä¸¥å‰çš„"æ³•å®˜"å’ŒçŠ€åˆ©çš„"æ£€å¯Ÿå®˜"ã€‚', choices: [
            { text: 'ç†¬å¤œå‡†å¤‡è¾©æŠ¤è¯', effects: { focus: 2, health: -1, resistance: -2 }, check: { stat: 'focus', val: 5, success: 'ç²¾å½©è´¨è¯æ‰­è½¬æ¡ˆæƒ…ï¼', fail: 'ç´§å¼ å¿˜è¯ï¼Œè¡¨ç°ç³Ÿç³•ã€‚' } },
            { text: 'ä¸é˜Ÿå‹åå¤æ¼”ç»ƒ', effects: { social: 1, resistance: -1 }, check: { stat: 'social', val: 3, success: 'é…åˆé»˜å¥‘ï¼ŒæˆåŠŸè¾©æŠ¤ã€‚', fail: 'é…åˆå¤±è¯¯ï¼Œç¨‹åºé”™è¯¯ã€‚' } }
        ]},
        { id: 'legal_clinic', title: 'æ³•å¾‹æ´åŠ©å®è·µ', desc: 'ä¸ºç¤¾åŒºå±…æ°‘æä¾›å…è´¹å’¨è¯¢ï¼Œé‡åˆ°å¤æ‚è´¢äº§çº çº·ã€‚', choices: [
            { text: 'æ¥ä¸‹å¤æ‚æ¡ˆä»¶æŒ‘æˆ˜', effects: { focus: 2, resistance: -2, social: 1 }, check: { stat: 'focus', val: 4, success: 'æˆåŠŸè°ƒè§£ï¼Œèµ¢å¾—å£ç¢‘ã€‚', fail: 'è¶…å‡ºèƒ½åŠ›ï¼Œè½¬äº¤å¯¼å¸ˆã€‚' } },
            { text: 'ä»ç®€å•å’¨è¯¢åšèµ·', effects: { social: 2, resistance: 1 } }
        ]}
    ],
    education: [
        { id: 'teaching_practice', title: 'è®²å°åˆä½“éªŒ', desc: 'ç¬¬ä¸€æ¬¡é¢å¯¹çœŸå®ä¸­å°å­¦ç”Ÿï¼Œè¯¾å ‚ç§©åºæ··ä¹±ã€‚', choices: [
            { text: 'ä¸¥æ ¼è¦æ±‚ï¼Œæ ‘ç«‹æƒå¨', effects: { focus: 2, resistance: -1 }, check: { stat: 'focus', val: 3, success: 'çºªå¾‹å¥½è½¬ï¼Œæ•™å­¦æœ‰æ•ˆã€‚', fail: 'è¿‡äºä¸¥å‰ï¼Œå­¦ç”ŸæŠµè§¦ã€‚' } },
            { text: 'å¯“æ•™äºä¹ï¼Œæ¸¸æˆäº’åŠ¨', effects: { talent: 2, social: 1 }, check: { stat: 'talent', val: 3, success: 'è¯¾å ‚æ´»è·ƒï¼Œæ·±å—å–œçˆ±ã€‚', fail: 'åœºé¢å¤±æ§ï¼Œå˜æˆæ¸¸ä¹åœºã€‚' } }
        ]},
        { id: 'classroom_management', title: 'ç­çº§ç®¡ç†å±æœº', desc: 'å®ä¹ ç­çº§çˆ†å‘å†²çªï¼Œä¸¤åå­¦ç”Ÿæ‰“æ¶ã€‚', choices: [
            { text: 'ä¸¥è‚ƒæ‰¹è¯„æ•™è‚²', effects: { resistance: -1, focus: 1 }, check: { stat: 'resistance', val: 3, success: 'å†·é™å¤„ç†ï¼ŒåŒ–è§£çŸ›ç›¾ã€‚', fail: 'å¤„ç†ä¸å½“ï¼Œå®¶é•¿æŠ•è¯‰ã€‚' } },
            { text: 'è°ˆå¿ƒç–å¯¼ï¼Œäº†è§£åŸå› ', effects: { social: 2, resistance: -1 } }
        ]}
    ],
    literature: [
        { id: 'writing_contest', title: 'æ ¡å›­æ–‡å­¦å¥–æˆªç¨¿', desc: 'å°è¯´åˆ›ä½œå¤§èµ›ä¸´è¿‘æˆªæ­¢ï¼Œä½ çš„ä½œå“å°šæœªå®Œæˆã€‚', choices: [
            { text: 'é—­å…³åˆ›ä½œï¼Œè¿½æ±‚å®Œç¾', effects: { talent: 3, health: -1, resistance: -2, social: -1 }, check: { stat: 'talent', val: 4, success: 'ä½œå“è·ä¸€ç­‰å¥–ï¼Œå³å°†å‘è¡¨ã€‚', fail: 'é”™è¿‡æˆªç¨¿æ—¥æœŸã€‚' } },
            { text: 'å‚åŠ å†™ä½œå·¥ä½œåŠ', effects: { social: 2, talent: 1 } }
        ]},
        { id: 'poetry_slam', title: 'è¯—æ­Œæœ—è¯µä¹‹å¤œ', desc: 'ç°ä»£è¯—æœ—è¯µä¼šï¼Œä½ éœ€è¦ä¸Šå°è¡¨æ¼”åŸåˆ›è¯—æ­Œã€‚', choices: [
            { text: 'æœ—è¯µæ¿€è¿›å®éªŒè¯—ä½œ', effects: { talent: 2, resistance: -1 }, check: { stat: 'talent', val: 4, success: 'æƒŠè‰³å…¨åœºï¼Œå¼•å‘è®¨è®ºã€‚', fail: 'è§‚ä¼—æ— æ³•ç†è§£ï¼Œå†·åœºå°´å°¬ã€‚' } },
            { text: 'é€‰æ‹©ä¿å®ˆç»å…¸é£æ ¼', effects: { focus: 1, resistance: 1 } }
        ]}
    ],
    history: [
        { id: 'archaeological_dig', title: 'ç”°é‡è€ƒå¤å‘æ˜', desc: 'æš‘æœŸå‚ä¸é‡å¤–å‘æ˜ï¼Œæ¡ä»¶è‰°è‹¦ä¸”æ¯ç‡¥ã€‚', choices: [
            { text: 'åšæŒä¸‹å·¥åœ°æŒ–æ¢æ–¹', effects: { focus: 2, health: -2, talent: 1 }, check: { stat: 'health', val: 3, success: 'å‘ç°é‡è¦æ–‡ç‰©ç¢ç‰‡ï¼', fail: 'ä¸­æš‘è„±æ°´ï¼Œè¢«è¿«æ’¤å›ã€‚' } },
            { text: 'ç•™åœ¨å®¤å†…æ•´ç†æ–‡çŒ®', effects: { focus: 1, health: 1 } }
        ]},
        { id: 'archive_research', title: 'å¤ç±æ¡£æ¡ˆç ”ç©¶', desc: 'åœ¨æ¡£æ¡ˆé¦†æŸ¥é˜…çè´µå²æ–™ï¼Œéœ€è¦æå¤§è€å¿ƒã€‚', choices: [
            { text: 'è¿ç»­å·¥ä½œå…«å°æ—¶', effects: { focus: 2, health: -1, resistance: -1 }, check: { stat: 'focus', val: 4, success: 'å‘ç°å…³é”®å²æ–™çº¿ç´¢ã€‚', fail: 'çœ¼èŠ±çœ‹é”™è¡Œï¼Œè®°å½•é”™è¯¯ã€‚' } },
            { text: 'å®šæ—¶ä¼‘æ¯ï¼Œä¿æŠ¤è§†åŠ›', effects: { health: 1, focus: -1 } }
        ]}
    ],
    science: [
        { id: 'lab_accident', title: 'å®éªŒå®¤æ„å¤–', desc: 'æ·±å¤œå®éªŒå‘ç”Ÿäº‹æ•…ï¼Œè¯•å‰‚æ³„æ¼ã€‚', choices: [
            { text: 'å†·é™å¤„ç†ï¼ŒæŠ¥å‘Šå¯¼å¸ˆ', effects: { focus: 2, resistance: -1 }, check: { stat: 'focus', val: 4, success: 'å¦¥å–„å¤„ç†ï¼Œè·å¯¼å¸ˆä¿¡ä»»ã€‚', fail: 'æ‰‹å¿™è„šä¹±ï¼Œæ‰©å¤§æŸå¤±ã€‚' } },
            { text: 'ç‹¬è‡ªå¤„ç†ï¼Œé¿å…å¤„ç½š', effects: { resistance: -3, health: -1 }, check: { stat: 'resistance', val: 3, success: 'ç’å¤©è¿‡æµ·ï¼Œå¿ƒæœ‰ä½™æ‚¸ã€‚', fail: 'éšç’è¢«å‘ç°ï¼Œä¸¥é‡å¤„åˆ†ã€‚' } }
        ]},
        { id: 'research_breakthrough', title: 'å®éªŒçªç ´', desc: 'è¿ç»­å®éªŒç»ˆäºæœ‰äº†å…³é”®æ•°æ®ã€‚', choices: [
            { text: 'ç«‹å³æ’°å†™è®ºæ–‡æŠ•ç¨¿', effects: { focus: 3, resistance: -2 }, check: { stat: 'focus', val: 5, success: 'è®ºæ–‡è¢«SCIæ”¶å½•ï¼', fail: 'å†™ä½œä»“ä¿ƒï¼Œè¢«å®¡ç¨¿äººæ‹’ç¨¿ã€‚' } },
            { text: 'ç»§ç»­è¡¥å……å®éªŒ', effects: { focus: 2, health: -1 } }
        ]}
    ],
    engineering: [
        { id: 'robotics_comp', title: 'æœºå™¨äººå¤§èµ›å†³èµ›', desc: 'è‡ªåŠ¨å¯¼èˆªå°è½¦æ¯”èµ›ï¼Œå°è½¦çªç„¶å¤±æ§ã€‚', choices: [
            { text: 'ç°åœºç´§æ€¥è°ƒè¯•ä»£ç ', effects: { talent: 2, health: -2, resistance: -2 }, check: { stat: 'talent', val: 4, success: 'ä¿®å¤æˆåŠŸï¼Œé€†è½¬å¤ºå† ï¼', fail: 'çŸ­è·¯çƒ§æ¯ä¸»æ¿ï¼Œé€€èµ›ã€‚' } },
            { text: 'å¯ç”¨å¤‡ç”¨æ–¹æ¡ˆ', effects: { focus: 2, health: 1 }, check: { stat: 'focus', val: 3, success: 'ç¨³å®šå‘æŒ¥ï¼Œè·å¾—äºŒç­‰å¥–ã€‚', fail: 'å¤‡ç”¨æ–¹æ¡ˆç¼ºé™·æ˜æ˜¾ã€‚' } }
        ]},
        { id: 'factory_visit', title: 'å·¥å‚å‚è§‚å®ä¹ ', desc: 'å‚è§‚é‡å·¥ä¸šå·¥å‚ï¼Œå™ªéŸ³å’Œé«˜æ¸©ä»¤äººä¸é€‚ã€‚', choices: [
            { text: 'æ·±å…¥è½¦é—´è®°å½•æµç¨‹', effects: { focus: 2, health: -1, resistance: -1 }, check: { stat: 'health', val: 3, success: 'è·å¾—ä¸€æ‰‹å·¥ç¨‹æ•°æ®ã€‚', fail: 'èº«ä½“ä¸é€‚ï¼Œæå‰ç¦»åœºã€‚' } },
            { text: 'åœ¨æ§åˆ¶å®¤è§‚æ‘©', effects: { focus: -1, health: 1 } }
        ]}
    ],
    agriculture: [
        { id: 'harvest_season', title: 'ç§‹æ”¶å†œå¿™æ—¶èŠ‚', desc: 'è¯•éªŒç”°å†œä½œç‰©æˆç†Ÿï¼Œéœ€è¦æŠ¢æ”¶ã€‚', choices: [
            { text: 'è¿ç»­ä¸€å‘¨ä¸‹ç”°åŠ³ä½œ', effects: { health: 2, focus: 1, resistance: -1 }, check: { stat: 'health', val: 3, success: 'ä¸°æ”¶ä¸”æ•°æ®å®Œæ•´ã€‚', fail: 'è¿‡åº¦åŠ³ç´¯ï¼Œè…°é…¸èƒŒç—›ã€‚' } },
            { text: 'é›‡ä½£ä¸´æ—¶å·¥ååŠ©', effects: { social: 1, resistance: 1, focus: -1 } }
        ]},
        { id: 'greenhouse_project', title: 'æ¸©å®¤å¤§æ£šé¡¹ç›®', desc: 'è´Ÿè´£è°ƒæ§æ¸©å®¤ç¯å¢ƒå‚æ•°ï¼Œç³»ç»Ÿçªç„¶æ•…éšœã€‚', choices: [
            { text: 'æ‰‹åŠ¨è°ƒæ§ï¼Œå½»å¤œå€¼å®ˆ', effects: { focus: 2, health: -2, resistance: -1 }, check: { stat: 'focus', val: 3, success: 'æŒ½æ•‘äº†çè´µä½œç‰©ã€‚', fail: 'æ“ä½œå¤±è¯¯ï¼ŒæŸå¤±ä¸¥é‡ã€‚' } },
            { text: 'è”ç³»æŠ€æœ¯äººå‘˜ç»´ä¿®', effects: { social: 1, resistance: 1 } }
        ]}
    ],
    medicine: [
        { id: 'first_surgery', title: 'æ‰‹æœ¯å°åˆä½“éªŒ', desc: 'ä½œä¸ºä¸€åŠ©å‚ä¸çœŸå®æ‰‹æœ¯ï¼Œç´§å¼ åˆ°æ‰‹æŠ–ã€‚', choices: [
            { text: 'å¼ºè¿«è‡ªå·±å†·é™', effects: { resistance: -2, focus: 2 }, check: { stat: 'resistance', val: 4, success: 'å®Œæˆç¼åˆï¼Œè·ä¸»åˆ€è¡¨æ‰¬ã€‚', fail: 'è¿‡åº¦ç´§å¼ ï¼Œè¢«èµ¶å‡ºæ‰‹æœ¯å®¤ã€‚' } },
            { text: 'è¯·æ±‚æ›´æ¢å™¨æ¢°æŠ¤å£«', effects: { focus: -1, health: 1 } }
        ]},
        { id: 'night_shift', title: 'è¿ç»­å¤œç­', desc: 'ä½é™¢éƒ¨è½®å€¼ï¼Œè¿ç»­å·¥ä½œ36å°æ—¶æœªçœ ã€‚', choices: [
            { text: 'ç¡¬æ’‘åˆ°åº•', effects: { health: -3, focus: 1, resistance: -2 }, check: { stat: 'health', val: 4, success: 'æ‰›ä½äº†ï¼Œèº«å¿ƒä¿±ç–²ã€‚', fail: 'æ™•å€’å€¼ç­å®¤ï¼Œé€æ€¥è¯Šã€‚' } },
            { text: 'ç”³è¯·è°ƒä¼‘', effects: { health: 1, social: -1 } }
        ]}
    ],
    arts: [
        { id: 'gallery_opening', title: 'ä¸ªå±•å¼€å¹•å¼', desc: 'ä½œå“å…¥é€‰æ ¡å†…ç¾æœ¯é¦†ï¼Œéœ€è¦è‡´è¾ã€‚', choices: [
            { text: 'ç››è£…å‡ºå¸­ï¼Œç§¯æç¤¾äº¤', effects: { social: 3, talent: 1, resistance: -1 }, check: { stat: 'social', val: 4, success: 'ç»“è¯†ç”»å»Šä¸»ï¼Œä½œå“è¢«æ”¶è—ã€‚', fail: 'è‡ªæˆ‘ä»‹ç»å°´å°¬ï¼Œæ”¶æ•ˆç”šå¾®ã€‚' } },
            { text: 'ä¸“æ³¨ä½œå“è®²è§£', effects: { talent: 2, focus: 1 } }
        ]},
        { id: 'performance_night', title: 'æ±‡æŠ¥æ¼”å‡º', desc: 'æœŸæœ«æ±‡æŠ¥æ¼”å‡ºï¼Œä½ çš„èŠ‚ç›®å‹è½´ç™»åœºã€‚', choices: [
            { text: 'æŒ‘æˆ˜é«˜éš¾åº¦å³å…´åˆ›ä½œ', effects: { talent: 3, resistance: -2 }, check: { stat: 'talent', val: 5, success: 'å®Œç¾æ¼”ç»ï¼Œå…¨åœºèµ·ç«‹é¼“æŒã€‚', fail: 'å¤±è¯¯é¢‘å‡ºï¼Œæ¼”ç ¸äº†ã€‚' } },
            { text: 'ä¿å®ˆå®Œæˆæ—¢å®šæ›²ç›®', effects: { talent: 1, resistance: 1 } }
        ]}
    ],
    management: [
        { id: 'business_plan', title: 'åˆ›ä¸šè®¡åˆ’å¤§èµ›', desc: 'éœ€è¦æäº¤å®Œæ•´çš„å•†ä¸šè®¡åˆ’ä¹¦å¹¶è·¯æ¼”ã€‚', choices: [
            { text: 'ç»„å»ºè·¨ä¸“ä¸šå›¢é˜Ÿ', effects: { social: 2, talent: 1, resistance: -1 }, check: { stat: 'social', val: 4, success: 'æ–¹æ¡ˆå¤šå…ƒï¼Œè·æŠ•èµ„æ„å‘ã€‚', fail: 'å›¢é˜Ÿç®¡ç†æ··ä¹±ï¼Œäº’ç›¸æ¨è¯¿ã€‚' } },
            { text: 'ç‹¬è‡ªå®Œæˆæ‰€æœ‰å†…å®¹', effects: { focus: 2, resistance: -2, health: -1 }, check: { stat: 'focus', val: 4, success: 'ç‹¬ç«‹å®Œæˆï¼Œé€»è¾‘ä¸¥è°¨ã€‚', fail: 'ç²¾åŠ›æœ‰é™ï¼Œè´¢åŠ¡é¢„æµ‹å‡ºé”™ã€‚' } }
        ]},
        { id: 'leadership_camp', title: 'é¢†å¯¼åŠ›è®­ç»ƒè¥', desc: 'æˆ·å¤–æ‹“å±•é¡¹ç›®ï¼Œéœ€è¦æ‹…ä»»é˜Ÿé•¿ã€‚', choices: [
            { text: 'å¼ºåŠ¿æŒ‡æŒ¥ï¼Œè¿½æ±‚èƒœåˆ©', effects: { resistance: -1, social: 1 }, check: { stat: 'resistance', val: 3, success: 'å›¢é˜Ÿé«˜æ•ˆï¼Œèµ¢å¾—æ¯”èµ›ã€‚', fail: 'é˜Ÿå‘˜æŠµè§¦ï¼Œå›¢é˜Ÿåˆ†è£‚ã€‚' } },
            { text: 'æ°‘ä¸»åå•†ï¼Œç…§é¡¾é˜Ÿå‘˜', effects: { social: 2, focus: -1 } }
        ]}
    ]
};

const CONDITIONAL_EVENTS = {
    low_health: {
        id: 'low_health', condition: (stats) => stats.health <= 2, title: 'âš ï¸ å¥åº·é¢„è­¦', tag: 'ç´§æ€¥äº‹ä»¶',
        desc: 'ä½ çš„èº«ä½“å‘å‡ºäº†è­¦æŠ¥ã€‚è¿ç»­çš„ç†¬å¤œå’Œä¸è§„å¾‹é¥®é£Ÿè®©ä½ å¤´æ™•ç›®çœ©ã€‚',
        choices: [
            { text: 'ğŸ¥ è¯·å‡ä¼‘å…»ä¸€å‘¨', effects: { health: 3, resistance: 2, focus: -1 }, special: 'rest' },
            { text: 'ğŸ’Š ç¡¬æ’‘ç»§ç»­ä¸Šè¯¾', effects: { health: -2, resistance: -2 } },
            { text: 'ğŸƒ å¼€å§‹è§„å¾‹ä½œæ¯', effects: { health: 2, focus: -1, social: -1 } }
        ]
    },
    burnout: {
        id: 'burnout', condition: (stats) => stats.resistance <= 0, title: 'âš ï¸ å¿ƒç†å´©æºƒ', tag: 'å¿ƒç†å±æœº',
        desc: 'é•¿æœŸçš„å‹åŠ›ç§¯ç´¯çªç ´äº†å¿ƒç†é˜²çº¿ã€‚ä½ æ„Ÿåˆ°æåº¦ç–²æƒ«ã€ç„¦è™‘ï¼Œæ— æ³•é›†ä¸­æ³¨æ„åŠ›ã€‚',
        choices: [
            { text: 'ğŸ§˜ å¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢', effects: { resistance: 5, health: 2, social: 1 }, special: 'counseling' },
            { text: 'ğŸ  å›å®¶ä¼‘å…»ä¸€æ®µæ—¶é—´', effects: { resistance: 4, health: 3, focus: -2, social: -1 }, special: 'rest' },
            { text: 'ğŸ“š å¼ºè¿«è‡ªå·±ç»§ç»­å­¦ä¹ ', effects: { resistance: -1, health: -3, focus: -2 } }
        ]
    },
    popular: {
        id: 'popular', 
        condition: (stats, state) => stats.social >= 8 && state.semester >= 4 && (state.eventCounts.popular || 0) < 2, 
        title: 'ğŸŒŸ æ ¡å›­é£äº‘äººç‰©', 
        tag: 'ç‰¹æ®Šæœºé‡',
        desc: 'ä½ çš„ç¤¾äº¤å½±å“åŠ›è¾å°„æ•´ä¸ªæ ¡å›­ï¼Œå„ç§æœºä¼šæ‰¾ä¸Šé—¨æ¥ã€‚',
        choices: [
            { text: 'ğŸ¤ ç«é€‰å­¦ç”Ÿä¼šä¸»å¸­', effects: { social: 2, resistance: -2, focus: -1 }, check: { stat: 'social', val: 8, success: 'é«˜ç¥¨å½“é€‰ï¼Œæˆä¸ºå­¦ç”Ÿé¢†è¢–ï¼', fail: 'è™½ç„¶è½é€‰ï¼Œä½†çŸ¥ååº¦æå‡ã€‚' } },
            { text: 'ğŸ’¼ æ¥å—ä¼ä¸šå®ä¹ é‚€è¯·', effects: { focus: 2, social: 1, resistance: -1 } }
        ]
    },
    academic_warning: {
        id: 'academic_warning', condition: (state) => state.gpa < 2.0, title: 'ğŸ“‰ å­¦ä¸šè­¦å‘Š', tag: 'å­¦ä¸šå±æœº',
        desc: 'ä½ çš„GPAä½äºå­¦æ ¡è¦æ±‚ï¼Œæ”¶åˆ°äº†å­¦ä¸šè­¦å‘Šé€šçŸ¥ä¹¦ã€‚',
        choices: [
            { text: 'ğŸ“š æš‚åœç¤¾å›¢ï¼Œä¸“å¿ƒå­¦ä¸š', effects: { focus: 3, social: -2, resistance: -1 } },
            { text: 'ğŸ¤ æ‰¾å¯¼å¸ˆè°ˆè¯å¯»æ±‚å¸®åŠ©', effects: { focus: 2, social: 1, resistance: 1 } },
            { text: 'ğŸ˜° é™·å…¥è‡ªæš´è‡ªå¼ƒ', effects: { resistance: -3, health: -2, focus: -2 } }
        ]
    }
};

const COMMON_EVENTS = [
    { id: 'military_training', semester: 0, title: 'çƒˆæ—¥ä¸‹çš„å†›è®­', tag: 'å…¥å­¦é€‚åº”', desc: 'ä¹æœˆçš„çƒˆæ—¥ä¸‹ï¼Œä½ ä»¬æ­£åœ¨è¿›è¡Œé˜Ÿåˆ—è®­ç»ƒã€‚æ±—æ°´æµ¸é€äº†å†›è£…ï¼Œè„šåè·Ÿå·²ç»ç£¨å‡ºäº†æ°´æ³¡ã€‚', choices: [
        { text: 'å’¬ç‰™åšæŒï¼Œäº‰å–æ ‡å…µ', effects: { resistance: 1, health: -1, focus: 1 }, check: { stat: 'health', val: 3, success: 'ä½ å‡­å€Ÿé¡½å¼ºæ„å¿—è·å¾—å†›è®­æ ‡å…µç§°å·ï¼', fail: 'ä½ ä¸­æš‘æ™•å€’ï¼Œè¢«é€å¾€åŒ»åŠ¡å®¤ã€‚' } },
        { text: 'ç”³è¯·ç—…å‡ï¼Œæ—è§‚ä¼‘æ¯', effects: { health: 1, resistance: -1, social: -1 } },
        { text: 'ç§¯æè¡¨ç°ï¼Œæˆä¸ºé€šè®¯å‘˜', effects: { social: 2, resistance: -1 } }
    ]},
    { id: 'club_recruit', semester: 0, title: 'ç™¾å›¢å¤§æˆ˜', tag: 'ç¤¾å›¢çº³æ–°', desc: 'æ“åœºä¸Šäººå£°é¼æ²¸ï¼Œå„ä¸ªç¤¾å›¢ä½¿å‡ºæµ‘èº«è§£æ•°æ‹›æ–°ã€‚éŸ³ä¹ã€èˆè¹ˆã€è¾©è®ºã€ç§‘æŠ€...ä½ è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ', choices: [
        { text: 'ğŸ¸ åŠ å…¥æ–‡è‰ºç±»ç¤¾å›¢', effects: { talent: 2, social: 1, health: -1 }, check: { stat: 'talent', val: 2, success: 'æ‰åå¾—åˆ°è®¤å¯ï¼Œæˆä¸ºç¤¾å›¢éª¨å¹²ã€‚', fail: 'æ’ç»ƒå ç”¨å¤ªå¤šæ—¶é—´ï¼Œæ„Ÿåˆ°ç–²æƒ«ã€‚' } },
        { text: 'ğŸ—£ï¸ åŠ å…¥è¾©è®º/æ¼”è®²ç¤¾å›¢', effects: { social: 2, focus: 1, resistance: -1 }, check: { stat: 'social', val: 2, success: 'å£æ‰æƒŠè‰³å…¨åœºï¼Œæˆä¸ºæ˜æ˜Ÿè¾©æ‰‹ã€‚', fail: 'è¾©è®ºä¸­è¯­æ— ä¼¦æ¬¡ï¼Œè‡ªä¿¡å¿ƒå—æŒ«ã€‚' } },
        { text: 'ğŸ”¬ åŠ å…¥å­¦æœ¯/ç§‘æŠ€ç¤¾å›¢', effects: { focus: 2, talent: 1, social: -1 }, check: { stat: 'focus', val: 3, success: 'æ‰¾åˆ°å¿—åŒé“åˆçš„ä¼™ä¼´ã€‚', fail: 'å­¦æœ¯è®¨è®ºå¤ªæ¯ç‡¥ï¼Œä¸­é€”é€€å‡ºã€‚' } }
    ]},
    { id: 'first_exam', semester: 0, title: 'å¤§å­¦ç¬¬ä¸€æ¬¡æœŸä¸­', tag: 'å­¦ä¸šå‹åŠ›', desc: 'ç¬¬ä¸€æ¬¡å¤§å­¦æœŸä¸­è€ƒè¯•æ¥äº†ï¼Œä½ å‘ç°é«˜ä¸­é‚£å¥—å­¦ä¹ æ–¹æ³•ä¼¼ä¹ä¸ç®¡ç”¨äº†ã€‚', choices: [
        { text: 'â˜• é€šå®µçªå‡»å¤ä¹ ', effects: { focus: 1, health: -2, resistance: -2 }, check: { stat: 'focus', val: 3, success: 'ä¸´æ—¶æŠ±ä½›è„šæœ‰ç”¨ï¼åŠæ ¼ä¸‡å²ã€‚', fail: 'ç†¬å¤œä¼¤èº«ï¼Œè€ƒåœºä¸Šç¡ç€äº†ã€‚' } },
        { text: 'ğŸ¤ ç»„å»ºå­¦ä¹ å°ç»„', effects: { social: 1, focus: 1 }, check: { stat: 'social', val: 2, success: 'å­¦éœ¸åŒå­¦åˆ†äº«ç¬”è®°ï¼Œæ”¶è·é¢‡ä¸°ã€‚', fail: 'å°ç»„å˜æˆäº†èŠå¤©å±€ï¼Œæ•ˆç‡ä½ä¸‹ã€‚' } }
    ]},
    { id: 'major_transfer', semester: 1, title: 'è½¬ä¸“ä¸šç”³è¯·', tag: 'å…³é”®æŠ‰æ‹©', desc: 'å­¦æ ¡å¼€æ”¾è½¬ä¸“ä¸šç”³è¯·ï¼Œä½ å¯¹ç°åœ¨çš„ä¸“ä¸šäº§ç”ŸåŠ¨æ‘‡ã€‚', choices: [
        { text: 'è®¤çœŸå‡†å¤‡è½¬ä¸“ä¸šè€ƒè¯•', effects: { focus: 2, resistance: -2, health: -1 }, check: { stat: 'focus', val: 4, success: 'æˆåŠŸè½¬å…¥ç†æƒ³ä¸“ä¸šï¼', fail: 'è€ƒè¯•å¤±åˆ©ï¼Œç•™åœ¨åŸä¸“ä¸šã€‚' } },
        { text: 'ç•™åœ¨æœ¬ä¸“ä¸šæ·±è€•', effects: { focus: 1, resistance: 1, social: -1 } },
        { text: 'è¾…ä¿®ç¬¬äºŒä¸“ä¸š', effects: { focus: -1, resistance: -1, talent: 1 } }
    ]},
    { id: 'spring_sports', semester: 1, title: 'æ˜¥å­£è¿åŠ¨ä¼š', tag: 'æ ¡å›­æ´»åŠ¨', desc: 'æ ¡è¿ä¼šå³å°†å¼€å¹•ï¼Œç­çº§éœ€è¦æŠ¥åå‚èµ›é¡¹ç›®ã€‚', choices: [
        { text: 'ğŸƒ æŠ¥åé•¿è·‘é¡¹ç›®', effects: { health: 2, resistance: 1, focus: -1 }, check: { stat: 'health', val: 3, success: 'è·å¾—ç¬¬ä¸‰åï¼Œä¸ºç­çº§äº‰å…‰ï¼', fail: 'ä½“åŠ›ä¸æ”¯ï¼Œä¸­é€”é€€èµ›ã€‚' } },
        { text: 'ğŸ“£ ç»„ç»‡ç­çº§å•¦å•¦é˜Ÿ', effects: { social: 2, focus: -1 } },
        { text: 'ğŸ‘€ å……å½“è§‚ä¼—', effects: { health: 1, social: -1 } }
    ]},
    { id: 'winter_social', semester: 1, title: 'å¯’å‡ç¤¾ä¼šå®è·µ', tag: 'ç¤¾ä¼šå®è·µ', desc: 'å­¦æ ¡è¦æ±‚å¿…é¡»å‚åŠ ç¤¾ä¼šå®è·µï¼ŒåŒ—æ–¹çš„å†¬å¤©å¯’é£åˆºéª¨ã€‚', choices: [
        { text: 'â„ï¸ å‚åŠ å±±åŒºæ”¯æ•™', effects: { resistance: -2, health: -1, social: 2, talent: 1 }, check: { stat: 'health', val: 3, success: 'è™½ç„¶è‰°è‹¦ï¼Œä½†å­©å­ä»¬çº¯çœŸçš„ç¬‘å®¹æ²»æ„ˆäº†ä½ ã€‚', fail: 'æ¶åŠ£ç¯å¢ƒè®©ä½ å¤§ç—…ä¸€åœºã€‚' } },
        { text: 'ğŸ’¼ å®¶ä¹¡ä¼ä¸šå®ä¹ ', effects: { focus: 2, resistance: -1 }, check: { stat: 'social', val: 2, success: 'çˆ¶æ¯æ‰˜å…³ç³»æ‰¾åˆ°äº†å¥½å²—ä½ã€‚', fail: 'è¢«å½“æˆå»‰ä»·åŠ³åŠ¨åŠ›ã€‚' } }
    ]},
    { id: 'core_course', semester: 2, title: 'ä¸“ä¸šæ ¸å¿ƒè¯¾', tag: 'å­¦ä¸šå‹åŠ›', desc: 'éš¾åº¦é™¡å¢çš„ä¸“ä¸šæ ¸å¿ƒè¯¾ï¼Œæ•™æˆè¦æ±‚æä¸ºä¸¥æ ¼ï¼ŒæŒ‚ç§‘ç‡30%ã€‚', choices: [
        { text: 'ğŸ“š æ¯å¤©è‡ªä¹ åˆ°é—­é¦†', effects: { focus: 3, health: -1, resistance: -2 }, check: { stat: 'focus', val: 5, success: 'æŒæ¡æ ¸å¿ƒçŸ¥è¯†ï¼Œè€ƒè¯•æ‹¿Aã€‚', fail: 'æ–¹æ³•ä¸å¯¹ï¼ŒåŠªåŠ›ç™½è´¹ã€‚' } },
        { text: 'ğŸ¤ æŠ±å­¦éœ¸å¤§è…¿', effects: { social: 1, focus: 1, resistance: -1 }, check: { stat: 'social', val: 3, success: 'å­¦éœ¸ç¬”è®°æ‹¯æ•‘äº†ä½ ã€‚', fail: 'å­¦éœ¸å¤ªå¿™ï¼Œæ— æš‡é¡¾åŠä½ ã€‚' } }
    ]},
    { id: 'cet_exam', semester: 2, title: 'è‹±è¯­å››å…­çº§', tag: 'æŠ€èƒ½è€ƒè¯•', desc: 'è‹±è¯­å››çº§è€ƒè¯•ä¸´è¿‘ï¼Œè¿™æ˜¯æ¯•ä¸šçš„ç¡¬æ€§è¦æ±‚ã€‚', choices: [
        { text: 'ğŸ“– åˆ·çœŸé¢˜èƒŒå•è¯', effects: { focus: 2, resistance: -1 }, check: { stat: 'focus', val: 3, success: 'é«˜åˆ†é€šè¿‡ï¼', fail: 'ä½åˆ†é£˜è¿‡ï¼ŒæƒŠé™©åŠæ ¼ã€‚' } },
        { text: 'ğŸ§ çœ‹ç¾å‰§ç»ƒå¬åŠ›', effects: { talent: 1, focus: 1, resistance: 1 } }
    ]},
    { id: 'research_intro', semester: 2, title: 'ç§‘ç ”å…¥é—¨', tag: 'å­¦æœ¯å‘å±•', desc: 'å¯¼å¸ˆé‚€è¯·æœ¬ç§‘ç”Ÿå‚ä¸åŸºç¡€ç§‘ç ”é¡¹ç›®ï¼Œä½†æ¯ç‡¥çš„æ–‡çŒ®é˜…è¯»è®©äººå´æ­¥ã€‚', choices: [
        { text: 'ğŸ”¬ åŠ å…¥è¯¾é¢˜ç»„', effects: { focus: 2, talent: 1, social: -1, resistance: -1 } },
        { text: 'ğŸ“Š å…ˆè§‚æœ›ä¸€å­¦æœŸ', effects: { focus: -1, social: 1 } }
    ]},
    { id: 'internship_hunt', semester: 3, title: 'æš‘æœŸå®ä¹ ç”³è¯·', tag: 'èŒä¸šè§„åˆ’', desc: 'å‘¨å›´åŒå­¦å¼€å§‹æŠ•ç®€å†æ‰¾å®ä¹ ï¼Œä½ ä¹Ÿè¯¥ä¸ºæœªæ¥æ‰“ç®—äº†ã€‚', choices: [
        { text: 'ğŸ“„ æµ·æŠ•ç®€å†ï¼Œå¹¿æ’’ç½‘', effects: { social: 1, resistance: -2, focus: 1 }, check: { stat: 'social', val: 3, success: 'æ”¶åˆ°å¤šå®¶é¢è¯•é‚€è¯·ã€‚', fail: 'ç®€å†çŸ³æ²‰å¤§æµ·ï¼Œç„¦è™‘å€å¢ã€‚' } },
        { text: 'ğŸ”§ æå‡æŠ€èƒ½å†å‡ºå‘', effects: { talent: 2, focus: 1, social: -1 } },
        { text: 'ğŸ–ï¸ è®¡åˆ’æš‘æœŸæ—…è¡Œ', effects: { health: 2, resistance: 2, focus: -1 } }
    ]},
    { id: 'love_affair', semester: 3, title: 'æ˜¥æ—¥æ‹æ­Œ', tag: 'æƒ…æ„Ÿç”Ÿæ´»', desc: 'æ¨±èŠ±æ ‘ä¸‹ï¼Œæœ‰äººå‘ä½ è¡¨ç™½ã€‚æ˜¯æ¥å—è¿™ä»½æ„Ÿæƒ…ï¼Œè¿˜æ˜¯ä¸“æ³¨å­¦ä¸šï¼Ÿ', choices: [
        { text: 'â¤ï¸ æ¥å—è¡¨ç™½', effects: { social: 3, focus: -2, resistance: 1, health: 1 } },
        { text: 'ğŸ“š å©‰æ‹’ï¼Œä¸“æ³¨å­¦ä¹ ', effects: { focus: 2, social: -1, resistance: -1 } },
        { text: 'ğŸ¤ åšæœ‹å‹ï¼Œè§‚å¯Ÿçœ‹çœ‹', effects: { social: 1, focus: -1 } }
    ]},
    { id: 'major_competition', semester: 3, title: 'ä¸“ä¸šç«èµ›é€‰æ‹”', tag: 'ç«èµ›æŒ‘æˆ˜', desc: 'å…¨å›½å¤§å­¦ç”Ÿä¸“ä¸šç›¸å…³ç«èµ›å¼€å§‹æŠ¥åï¼Œæ˜¯æŒ‘æˆ˜è‡ªæˆ‘çš„æœºä¼šã€‚', choices: [
        { text: 'ğŸ† ç»„é˜ŸæŠ¥åå‚èµ›', effects: { talent: 2, focus: 1, resistance: -2, health: -1 }, check: { stat: 'talent', val: 4, success: 'ä¸€è·¯è¿‡å…³æ–©å°†ï¼Œè¿›å…¥å›½èµ›ï¼', fail: 'åˆèµ›å°±è¢«æ·˜æ±°ï¼Œå¤‡å—æ‰“å‡»ã€‚' } },
        { text: 'ğŸ‘€ æ—è§‚å­¦ä¹ ', effects: { focus: 1, resistance: 1 } }
    ]},
    { id: 'future_path', semester: 4, title: 'æœªæ¥å²”è·¯å£', tag: 'å…³é”®æŠ‰æ‹©', desc: 'ä¿ç ”ã€è€ƒç ”ã€å‡ºå›½ã€å°±ä¸š...ä½ å¿…é¡»åšå‡ºåˆæ­¥é€‰æ‹©äº†ã€‚', choices: [
        { text: 'ğŸ“ å‡†å¤‡ä¿ç ”ææ–™', effects: { focus: 2, resistance: -2 }, check: { stat: 'focus', val: 5, success: 'æ’åé å‰ï¼Œä¿ç ”æœ‰æœ›ã€‚', fail: 'ç«äº‰æ¿€çƒˆï¼Œå¤„äºè¾¹ç¼˜ã€‚' } },
        { text: 'ğŸ“š å¼€å§‹è€ƒç ”å¤ä¹ ', effects: { focus: 3, health: -1, resistance: -2 } },
        { text: 'âœˆï¸ å‡†å¤‡å‡ºå›½è¯­è¨€è€ƒè¯•', effects: { focus: 2, talent: 1, resistance: -1 } },
        { text: 'ğŸ’¼ å…¨åŠ›æ‰¾å®ä¹ ç§¯ç´¯ç»éªŒ', effects: { social: 2, focus: 1, resistance: -1 } }
    ]},
    { id: 'academic_forum', semester: 4, title: 'å­¦æœ¯è®ºå›æŠ¥å‘Š', tag: 'å­¦æœ¯å±•ç¤º', desc: 'ä½ çš„ä¸€ç¯‡è¯¾ç¨‹è®ºæ–‡è¢«é€‰ä¸­åœ¨é™¢çº§è®ºå›å±•ç¤ºï¼Œéœ€è¦é¢å¯¹ä¼—å¤šæ•™æˆã€‚', choices: [
        { text: 'ğŸ¤ è„±ç¨¿æ¼”è®²ï¼Œå±•ç¤ºé£é‡‡', effects: { social: 2, talent: 1, resistance: -2 }, check: { stat: 'social', val: 4, success: 'æŠ¥å‘Šç²¾å½©ï¼Œè·å¾—æ•™æˆé’çã€‚', fail: 'ç´§å¼ å¿˜è¯ï¼Œåœºé¢å°´å°¬ã€‚' } },
        { text: 'ğŸ“‘ ç…§æœ¬å®£ç§‘ï¼Œç¨³å¦¥ä¸ºä¸Š', effects: { focus: 1, resistance: -1 } }
    ]},
    { id: 'certificate', semester: 4, title: 'èŒä¸šè¯ä¹¦è€ƒè¯•', tag: 'æŠ€èƒ½æå‡', desc: 'æ•™å¸ˆèµ„æ ¼è¯ã€CPAã€å¸æ³•è€ƒè¯•ç­‰ä¸“ä¸šè¯ä¹¦æŠ¥åå¼€å§‹ã€‚', choices: [
        { text: 'ğŸ“– æŠ¥åå¹¶å…¨åŠ›å¤‡è€ƒ', effects: { focus: 2, resistance: -2, health: -1 }, check: { stat: 'focus', val: 4, success: 'é¡ºåˆ©é€šè¿‡åŸºç¡€ç§‘ç›®ï¼', fail: 'éš¾åº¦å¤ªå¤§ï¼Œéœ€è¦å†æˆ˜ã€‚' } },
        { text: 'â° æ˜å¹´å†è¯´', effects: { resistance: 1, focus: -1 } }
    ]},
    { id: 'summer_intern', semester: 5, title: 'æš‘æœŸä¸“ä¸šå®ä¹ ', tag: 'èŒä¸šä½“éªŒ', desc: 'è¿›å…¥ä¸“ä¸šç›¸å…³å•ä½å®ä¹ ï¼Œç†è®ºä¸ç°å®çš„å·®è·è®©ä½ å›°æƒ‘ã€‚', choices: [
        { text: 'ğŸ’ª ä¸»åŠ¨æ‰¿æ‹…æœ€éš¾çš„ä»»åŠ¡', effects: { focus: 2, resistance: -2, health: -1 }, check: { stat: 'focus', val: 4, success: 'å‡ºè‰²å®Œæˆï¼Œè·å¾—ç•™ç”¨æœºä¼šï¼', fail: 'æç ¸ä»»åŠ¡ï¼Œè¢«æ‰¹è¯„ã€‚' } },
        { text: 'ğŸ“– è§‚å¯Ÿå­¦ä¹ ï¼Œç§¯ç´¯ç»éªŒ', effects: { focus: 1, social: 1 } },
        { text: 'ğŸ˜° åº”ä»˜äº†äº‹ï¼Œå‡†å¤‡è€ƒç ”', effects: { focus: -1, resistance: -1 } }
    ]},
    { id: 'innovation_project', semester: 5, title: 'å¤§åˆ›é¡¹ç›®ç»“é¢˜', tag: 'ç§‘ç ”é¡¹ç›®', desc: 'ä¸»æŒçš„å¤§å­¦ç”Ÿåˆ›æ–°åˆ›ä¸šé¡¹ç›®åˆ°äº†ç»“é¢˜éªŒæ”¶é˜¶æ®µï¼Œæ•°æ®å´ä¸ç†æƒ³ã€‚', choices: [
        { text: 'ğŸ”¬ ä¼˜åŒ–æ•°æ®ï¼Œå®Œå–„æŠ¥å‘Š', effects: { focus: 2, talent: 1, resistance: -2 }, check: { stat: 'talent', val: 3, success: 'é¡¹ç›®è·è¯„ä¼˜ç§€ï¼', fail: 'å‹‰å¼ºç»“é¢˜ï¼Œæˆç»©ä¸€èˆ¬ã€‚' } },
        { text: 'ğŸ¤ æ±‚åŠ©å¯¼å¸ˆä¿®æ”¹', effects: { social: 1, focus: 1 } }
    ]},
    { id: 'grad_school_exam', semester: 5, title: 'è€ƒç ”å¤‡æˆ˜ç“¶é¢ˆ', tag: 'å­¦ä¸šå‹åŠ›', desc: 'è€ƒç ”å¤ä¹ è¿›å…¥ç–²åŠ³æœŸï¼Œæ¨¡æ‹Ÿè€ƒæˆç»©ä¸ç†æƒ³ã€‚', choices: [
        { text: 'ğŸ“š å¢åŠ å¼ºåº¦ï¼Œæ­»ç£•åˆ°åº•', effects: { focus: 2, health: -2, resistance: -3 }, check: { stat: 'resistance', val: 4, success: 'çªç ´ç“¶é¢ˆï¼Œæˆç»©æå‡ã€‚', fail: 'èº«å¿ƒä¿±ç–²ï¼Œæ•ˆç‡æ›´ä½ã€‚' } },
        { text: 'ğŸƒ è°ƒæ•´èŠ‚å¥ï¼ŒåŠ³é€¸ç»“åˆ', effects: { health: 2, resistance: 1, focus: -1 } },
        { text: 'ğŸšª è€ƒè™‘æ”¾å¼ƒï¼Œè½¬å‘å°±ä¸š', effects: { resistance: 2, social: 1, focus: -2 } }
    ]},
    { id: 'postgraduate_interview', semester: 6, title: 'ä¿ç ”/è€ƒç ”é¢è¯•', tag: 'äººç”Ÿå…³å¡', desc: 'æ¨å…é¢è¯•æˆ–è€ƒç ”å¤è¯•æ¥ä¸´ï¼Œè¿™æ˜¯å†³å®šå‘½è¿çš„æ—¶åˆ»ã€‚', choices: [
        { text: 'ğŸ“ å…¨åŠ›ä»¥èµ´ï¼Œå±•ç°è‡ªæˆ‘', effects: { focus: 2, resistance: -3, social: 1 }, check: { stat: 'focus', val: 5, success: 'é¢è¯•é€šè¿‡ï¼ŒæˆåŠŸä¸Šå²¸ï¼', fail: 'å‘æŒ¥å¤±å¸¸ï¼Œåè½å­™å±±ã€‚' } },
        { text: 'ğŸ¤ æ‰¾å¯¼å¸ˆæ²Ÿé€šå¥—ç£', effects: { social: 2, resistance: -1 } }
    ]},
    { id: 'autumn_recruitment', semester: 6, title: 'ç§‹æ‹›é»„é‡‘å­£', tag: 'æ±‚èŒå°±ä¸š', desc: 'æ ¡å›­æ‹›è˜ä¼šäººå±±äººæµ·ï¼Œä½ éœ€è¦åœ¨åƒå†›ä¸‡é©¬ä¸­çªå›´ã€‚', choices: [
        { text: 'ğŸ’¼ æµ·æŠ•ç®€å†ï¼Œç–¯ç‹‚é¢è¯•', effects: { social: 2, resistance: -2, health: -1 }, check: { stat: 'social', val: 4, success: 'æ‹¿åˆ°å¿ƒä»ªofferï¼', fail: 'å±¡å±¡ç¢°å£ï¼Œè‡ªæˆ‘æ€€ç–‘ã€‚' } },
        { text: 'ğŸ¯ ç²¾å‡†æŠ•é€’ï¼Œæœ‰çš„æ”¾çŸ¢', effects: { focus: 2, resistance: -1 } },
        { text: 'ğŸ“š æ”¾å¼ƒç§‹æ‹›ï¼Œå‡†å¤‡æ˜¥æ‹›', effects: { focus: 1, resistance: 1 } }
    ]},
    { id: 'thesis_proposal', semester: 6, title: 'æ¯•ä¸šè®ºæ–‡å¼€é¢˜', tag: 'å­¦æœ¯èµ·æ­¥', desc: 'é€‰é¢˜æŠ¥å‘Šä¼šä¸Šï¼Œä¸“å®¶ç»„å¯¹ä½ çš„é€‰é¢˜æå‡ºäº†å°–é”è´¨ç–‘ã€‚', choices: [
        { text: 'ğŸ›¡ï¸ æ®ç†åŠ›äº‰ï¼ŒåšæŒæ–¹å‘', effects: { focus: 2, resistance: -1 }, check: { stat: 'focus', val: 5, success: 'è¯´æœè¯„å§”ï¼Œé€‰é¢˜é€šè¿‡ã€‚', fail: 'è¢«è®¤ä¸ºå‡†å¤‡ä¸è¶³ï¼Œéœ€è¦ä¿®æ”¹ã€‚' } },
        { text: 'ğŸ“ è™šå¿ƒæ¥å—ï¼Œå¤§æ”¹æ–¹å‘', effects: { focus: -1, resistance: -2, health: -1 } }
    ]},
    { id: 'thesis_defense', semester: 7, title: 'æ¯•ä¸šç­”è¾©', tag: 'ç»ˆç‚¹ç«™', desc: 'å››å¹´æœ€åçš„å…³å¡ï¼Œå±•ç¤ºä½ çš„ç ”ç©¶æˆæœã€‚ç­”è¾©å§”å‘˜ä¼šä¸¥è‚ƒåœ°ååœ¨å°ä¸‹ã€‚', choices: [
        { text: 'ğŸ“ è‡ªä¿¡å±•ç¤ºï¼Œå¯¹ç­”å¦‚æµ', effects: { focus: 3, resistance: -2 }, check: { stat: 'focus', val: 5, success: 'ä¼˜ç§€æ¯•ä¸šè®ºæ–‡ï¼', fail: 'è¢«é—®ä½ï¼Œå‹‰å¼ºé€šè¿‡ã€‚' } },
        { text: 'ğŸ™ ç¥ˆç¥·é¡ºåˆ©ï¼Œä½è°ƒé€šè¿‡', effects: { resistance: -1, focus: 1 } }
    ]},
    { id: 'farewell_party', semester: 7, title: 'æ¯•ä¸šå‘Šåˆ«', tag: 'é’æ˜¥æ•£åœº', desc: 'æ•£ä¼™é¥­ä¸Šï¼Œå¤§å®¶æŠ±å¤´ç—›å“­ã€‚å››å¹´æ—¶å…‰è½¬ç¬å³é€ã€‚', choices: [
        { text: 'ğŸ» ä¸é†‰ä¸å½’ï¼Œå°½æƒ…å‘Šåˆ«', effects: { social: 3, health: -2, resistance: 2 } },
        { text: 'ğŸ“· æ‹ç…§ç•™å¿µï¼Œåˆ¶ä½œçºªå¿µå†Œ', effects: { talent: 2, social: 2 } },
        { text: 'ğŸ’¼ æå‰å»å•ä½æŠ¥åˆ°', effects: { focus: 2, social: -1 } }
    ]},
    { id: 'graduation_ceremony', semester: 7, title: 'å­¦ä½æˆäºˆä»ªå¼', tag: 'è£è€€æ—¶åˆ»', desc: 'æ ¡é•¿ä¸ºä½ æ‹¨ç©—ï¼Œå­¦ä½è¯ä¹¦ç»ˆäºåˆ°æ‰‹ã€‚å¤§å­¦ç”Ÿæ´»æ­£å¼ç”»ä¸Šå¥å·ã€‚', choices: [
        { text: 'ğŸ‰ åº†ç¥æ¯•ä¸šï¼Œå±•æœ›æœªæ¥', finalCheck: true }
    ]}
];

let gameState = {
    major: null,
    stats: { focus: 0, talent: 0, health: 0, social: 0, resistance: 0 },
    initialStats: {},
    gpa: 3.0,
    semester: 0,
    year: 1,
    history: [],
    currentEventIndex: 0,
    eventQueue: [],
    yearSummary: { 1: [], 2: [], 3: [], 4: [] },
    restUsed: false,
    dropoutConsidered: false,
    eventCounts: {}
};

function init() { renderMajors(); renderStatControls(); updateStatPreview(); }

function renderMajors() {
    const container = document.getElementById('major-list');
    container.innerHTML = MAJORS.map(m => `
        <div class="major-card p-4 rounded-xl border border-slate-600 bg-slate-800/50 cursor-pointer flex items-center gap-4" onclick="selectMajor('${m.id}')" id="major-${m.id}">
            <div class="text-3xl">${m.icon}</div>
            <div class="flex-grow">
                <div class="font-bold text-white">${m.name}</div>
                <div class="text-xs text-cyan-400 mb-1">${m.category}</div>
                <div class="text-xs text-slate-400">${m.desc}</div>
                <div class="mt-2 flex gap-2 text-xs">${m.advantages.map(a => `<span class="px-2 py-0.5 rounded bg-slate-700 text-slate-300">${STATS[a].name}</span>`).join('')}</div>
            </div>
        </div>
    `).join('');
}

let selectedMajorId = null, allocatedPoints = { focus: 0, talent: 0, health: 0, social: 0, resistance: 0 }, TOTAL_POINTS = 10;

function selectMajor(id) {
    selectedMajorId = id; allocatedPoints = { focus: 0, talent: 0, health: 0, social: 0, resistance: 0 };
    document.querySelectorAll('.major-card').forEach(el => el.classList.remove('selected'));
    document.getElementById(`major-${id}`).classList.add('selected');
    updateStatPreview(); renderStatControls();
}

function renderStatControls() {
    const container = document.getElementById('stats-container');
    if (!selectedMajorId) { container.innerHTML = '<p class="text-slate-500 italic">è¯·å…ˆé€‰æ‹©å­¦ç§‘é—¨ç±»...</p>'; return; }
    const major = MAJORS.find(m => m.id === selectedMajorId);
    container.innerHTML = Object.keys(STATS).map(key => {
        const base = major.baseStats[key], current = base + allocatedPoints[key];
        return `
            <div>
                <div class="flex justify-between mb-1">
                    <span class="text-sm text-slate-300">${STATS[key].icon} ${STATS[key].name} <span class="text-xs text-slate-500">(${STATS[key].desc})</span></span>
                    <span class="text-sm font-mono text-white"><span class="text-slate-500">${base}</span> + <span class="text-yellow-400">${allocatedPoints[key]}</span> = <span class="font-bold text-lg">${current}</span></span>
                </div>
                <div class="flex gap-2 items-center">
                    <button onclick="adjustStat('${key}', -1)" class="w-8 h-8 rounded bg-slate-700 hover:bg-slate-600 text-white font-bold">-</button>
                    <input type="range" min="0" max="10" value="${allocatedPoints[key]}" oninput="setStat('${key}', this.value)" class="flex-grow h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                    <button onclick="adjustStat('${key}', 1)" class="w-8 h-8 rounded bg-slate-700 hover:bg-slate-600 text-white font-bold">+</button>
                </div>
            </div>
        `;
    }).join('');
    updateRemainingPoints();
}

function adjustStat(key, delta) {
    const newVal = allocatedPoints[key] + delta, currentTotal = Object.values(allocatedPoints).reduce((a, b) => a + b, 0);
    if (newVal >= 0 && newVal <= 10 && (currentTotal + delta) <= TOTAL_POINTS) { allocatedPoints[key] = newVal; renderStatControls(); updateStatPreview(); }
}

function setStat(key, val) {
    val = parseInt(val); const otherStatsSum = Object.keys(allocatedPoints).filter(k => k !== key).reduce((sum, k) => sum + allocatedPoints[k], 0);
    if (otherStatsSum + val <= TOTAL_POINTS) { allocatedPoints[key] = val; renderStatControls(); updateStatPreview(); }
}

function updateRemainingPoints() {
    const used = Object.values(allocatedPoints).reduce((a, b) => a + b, 0), remaining = TOTAL_POINTS - used, el = document.getElementById('points-remaining');
    el.innerText = remaining; el.className = remaining === 0 ? 'text-green-400 font-bold' : 'text-yellow-400';
    document.getElementById('start-btn').disabled = (remaining !== 0 || !selectedMajorId);
}

function updateStatPreview() {
    const container = document.getElementById('stat-preview-bars');
    if (!selectedMajorId) { container.innerHTML = ''; return; }
    const major = MAJORS.find(m => m.id === selectedMajorId);
    container.innerHTML = Object.keys(STATS).map(key => {
        const val = major.baseStats[key] + allocatedPoints[key], pct = Math.min(100, (val / 10) * 100);
        return `<div class="flex items-center gap-2 text-xs"><span class="w-16 text-slate-400">${STATS[key].name}</span><div class="flex-grow stat-bar-bg"><div class="stat-bar-fill ${STATS[key].color}" style="width: ${pct}%"></div></div><span class="w-4 text-right">${val}</span></div>`;
    }).join('');
}

function startGame() {
    if (!selectedMajorId) return; const major = MAJORS.find(m => m.id === selectedMajorId); gameState.major = major;
    Object.keys(STATS).forEach(key => { gameState.stats[key] = major.baseStats[key] + allocatedPoints[key]; }); gameState.initialStats = {...gameState.stats};
    generateEventQueue(); document.getElementById('timeline-display').classList.remove('hidden'); updateTimeline();
    document.getElementById('screen-creation').classList.add('hidden'); document.getElementById('screen-gameplay').classList.remove('hidden'); document.getElementById('screen-gameplay').classList.add('fade-in');
    updateGameUI(); loadNextEvent();
}

function generateEventQueue() {
    gameState.eventQueue = [];
    const semesterStructure = { 0: ['welcome', 'major_specific_0', 'military_training', 'club_recruit', 'first_exam'], 1: ['major_specific_1', 'major_transfer', 'spring_sports', 'winter_social'], 2: ['major_specific_2', 'core_course', 'cet_exam', 'research_intro'], 3: ['major_specific_3', 'internship_hunt', 'love_affair', 'major_competition'], 4: ['major_specific_4', 'future_path', 'academic_forum', 'certificate'], 5: ['major_specific_5', 'summer_intern', 'innovation_project', 'grad_school_exam'], 6: ['major_specific_6', 'postgraduate_interview', 'autumn_recruitment', 'thesis_proposal'], 7: ['major_specific_7', 'thesis_defense', 'farewell_party', 'graduation_ceremony'] };
    for (let sem = 0; sem <= 7; sem++) {
        const structure = semesterStructure[sem], semEvents = [];
        structure.forEach(type => {
            if (type === 'welcome') semEvents.push(EVENTS.welcome);
            else if (type.startsWith('major_specific')) {
                const majorEvents = MAJOR_EVENTS[gameState.major.id], idx = parseInt(type.split('_')[2]);
                if (majorEvents && majorEvents[idx]) semEvents.push({...majorEvents[idx], semester: sem, tag: 'ä¸“ä¸šç‰¹è‰²', type: 'major'});
            } else { const event = COMMON_EVENTS.find(e => e.id === type); if (event) semEvents.push(event); }
        });
        gameState.eventQueue.push(...semEvents);
    }
}

function updateTimeline() {
    document.querySelectorAll('.timeline-item').forEach(item => {
        const sem = parseInt(item.dataset.sem);
        if (sem === gameState.semester) item.classList.add('active'); else item.classList.remove('active');
    });
}

function updateGameUI() {
    document.getElementById('game-major-name').innerText = gameState.major.name; document.getElementById('game-avatar').innerText = gameState.major.icon;
    const year = Math.floor(gameState.semester / 2) + 1, term = gameState.semester % 2 === 0 ? 'ä¸Š' : 'ä¸‹';
    document.getElementById('game-semester-display').innerText = `å¤§${['ä¸€','äºŒ','ä¸‰','å››'][year-1]}${term}å­¦æœŸ`; document.getElementById('game-year-display').innerText = `ç¬¬ ${year} å¹´ / å…± 4 å¹´`;
    document.getElementById('game-stats-display').innerHTML = Object.keys(STATS).map(key => {
        const val = gameState.stats[key], pct = Math.min(100, Math.max(0, (val / 15) * 100)), isLow = (key === 'health' && val < 3) || (key === 'resistance' && val < 3);
        return `<div class="mb-2"><div class="flex justify-between text-xs mb-1"><span class="text-slate-300">${STATS[key].icon} ${STATS[key].name}</span><span class="${isLow ? 'text-red-400 font-bold' : 'text-slate-300'}">${val}</span></div><div class="h-2 bg-slate-700 rounded-full overflow-hidden"><div class="h-full ${STATS[key].color} transition-all duration-500 ${isLow ? 'warning-pulse' : ''}" style="width: ${pct}%"></div></div></div>`;
    }).join('');
    checkStatusWarnings(); document.getElementById('game-gpa').innerText = gameState.gpa.toFixed(2);
}

function checkStatusWarnings() {
    const warnings = document.getElementById('status-warnings'); let html = '';
    if (gameState.stats.health <= 2) { html += '<div class="p-2 bg-red-900/50 border border-red-600 rounded text-xs text-red-200">âš ï¸ å¥åº·å€¼è¿‡ä½ï¼å»ºè®®ä¼‘æ¯</div>'; document.getElementById('rest-btn').classList.remove('hidden'); } else document.getElementById('rest-btn').classList.add('hidden');
    if (gameState.stats.resistance <= 3) html += '<div class="p-2 bg-orange-900/50 border border-orange-600 rounded text-xs text-orange-200">âš ï¸ æŠ—å‹å€¼è¿‡ä½ï¼æ¿’ä¸´å´©æºƒ</div>';
    if (gameState.gpa < 2.0) html += '<div class="p-2 bg-yellow-900/50 border border-yellow-600 rounded text-xs text-yellow-200">âš ï¸ GPAè¿‡ä½ï¼å­¦ä¸šè­¦å‘Š</div>';
    warnings.innerHTML = html;
}

function loadNextEvent() {
    const conditional = checkConditionalEvents(); if (conditional) { displayEvent(conditional); return; }
    const yearEndSemesters = [1, 3, 5];
    if (yearEndSemesters.includes(gameState.semester) && gameState.currentEventIndex > 0) {
        const year = Math.floor(gameState.semester / 2) + 1;
        if (!gameState.yearSummary[year] || gameState.yearSummary[year].length === 0) { showYearSummary(year); return; }
    }
    if (gameState.semester >= 7 && gameState.currentEventIndex >= gameState.eventQueue.length - 1) { endGame(); return; }
    let eventFound = false, attempts = 0, maxAttempts = 50;
    while (!eventFound && attempts < maxAttempts && gameState.currentEventIndex < gameState.eventQueue.length) {
        const event = gameState.eventQueue[gameState.currentEventIndex], eventId = event.id, currentCount = gameState.eventCounts[eventId] || 0;
        if (currentCount >= 2) { gameState.currentEventIndex++; attempts++; continue; }
        if (event.semester !== undefined && event.semester !== gameState.semester) { gameState.semester = event.semester; gameState.year = Math.floor(gameState.semester / 2) + 1; updateTimeline(); }
        gameState.eventCounts[eventId] = currentCount + 1; displayEvent(event); eventFound = true;
    }
    if (!eventFound) { if (gameState.semester >= 7) endGame(); else { const year = Math.floor(gameState.semester / 2) + 1; showYearSummary(year); } }
}

function checkConditionalEvents() {
    for (let key in CONDITIONAL_EVENTS) {
        const condEvent = CONDITIONAL_EVENTS[key];
        if (condEvent.condition(gameState.stats, gameState)) {
            const alreadyTriggered = gameState.history.some(h => h.eventId === condEvent.id && h.semester === gameState.semester);
            if (!alreadyTriggered) { gameState.eventCounts[condEvent.id] = (gameState.eventCounts[condEvent.id] || 0) + 1; return condEvent; }
        }
    }
    return null;
}

function displayEvent(event) {
    document.getElementById('event-tag').innerText = event.tag || 'æ ¡å›­ç”Ÿæ´»'; document.getElementById('event-tag').className = `px-3 py-1 rounded-full text-xs font-bold mb-2 inline-block ${getTagColor(event.tag)}`;
    document.getElementById('event-title').innerText = event.title; document.getElementById('event-desc').innerText = event.desc; document.getElementById('event-flavor').innerText = event.flavor || '';
    const choicesContainer = document.getElementById('choices-container'); choicesContainer.innerHTML = '';
    event.choices.forEach(choice => {
        const btn = document.createElement('button'); btn.className = 'choice-btn w-full text-left p-4 rounded-lg border border-slate-600 bg-slate-800/50 hover:border-blue-500 hover:bg-slate-700/50 transition group';
        let html = `<div class="font-bold text-white group-hover:text-blue-300 mb-1">${choice.text}</div>`; let effectsHint = [];
        for (let [k, v] of Object.entries(choice.effects || {})) { if (v > 0) effectsHint.push(`+${v} ${STATS[k].name}`); if (v < 0) effectsHint.push(`${v} ${STATS[k].name}`); }
        if (effectsHint.length > 0) html += `<div class="text-xs text-slate-500">${effectsHint.join(' | ')}</div>`; if (choice.risk) html += `<div class="text-xs text-red-400 mt-1">âš ï¸ ${choice.risk}</div>`;
        btn.innerHTML = html; btn.onclick = () => makeChoice(choice, event); choicesContainer.appendChild(btn);
    });
    document.getElementById('comparison-view').classList.add('hidden');
}

function getTagColor(tag) {
    const colors = { 'å…¥å­¦å­£': 'bg-blue-900 text-blue-200 border-blue-700', 'ç¤¾å›¢çº³æ–°': 'bg-purple-900 text-purple-200 border-purple-700', 'ä¸“ä¸šç‰¹è‰²': 'bg-cyan-900 text-cyan-200 border-cyan-700', 'å­¦ä¸šå‹åŠ›': 'bg-yellow-900 text-yellow-200 border-yellow-700', 'ç´§æ€¥äº‹ä»¶': 'bg-red-900 text-red-200 border-red-700', 'å¿ƒç†å±æœº': 'bg-red-900 text-red-200 border-red-700', 'ç‰¹æ®Šæœºé‡': 'bg-orange-900 text-orange-200 border-orange-700', 'å…³é”®æŠ‰æ‹©': 'bg-orange-900 text-orange-200 border-orange-700', 'ç»ˆç‚¹ç«™': 'bg-green-900 text-green-200 border-green-700' };
    return colors[tag] || 'bg-slate-700 text-slate-200 border-slate-600';
}

function makeChoice(choice, event) {
    const record = { semester: gameState.semester, year: gameState.year, eventId: event.id, event: event.title, choice: choice.text, statsBefore: {...gameState.stats}, gpaBefore: gameState.gpa };
    if (choice.special === 'rest') gameState.restUsed = true; let resultText = "", success = true;
    if (choice.finalCheck) { endGame(); return; }
    if (choice.check) {
        const statVal = gameState.stats[choice.check.stat];
        if (statVal >= choice.check.val) { resultText = choice.check.success; success = true; gameState.gpa = Math.min(4.0, gameState.gpa + 0.15); } else { resultText = choice.check.fail; success = false; gameState.gpa = Math.max(0.0, gameState.gpa - 0.1); }
    } else resultText = "ä½ åšå‡ºäº†é€‰æ‹©ï¼Œç”Ÿæ´»ç»§ç»­å‰è¡Œ...";
    for (let [key, val] of Object.entries(choice.effects || {})) gameState.stats[key] += val;
    // æ£€æŸ¥æ˜¯å¦æœ‰å±æ€§å€¼å½’é›¶æˆ–è´Ÿæ•°ï¼Œå¼ºåˆ¶é€€å‡º
    for (let k of Object.keys(gameState.stats)) {
        if (gameState.stats[k] <= 0) {
            gameState.stats[k] = 0;
            gameOverByAttribute(k);
            return;
        }
    }
    Object.keys(gameState.stats).forEach(k => { if (gameState.stats[k] < 0) gameState.stats[k] = 0; if (gameState.stats[k] > 15) gameState.stats[k] = 15; });
    if (gameState.stats.health < gameState.stats.resistance - 5) { resultText += " <br><span class='text-red-400'>âš ï¸ å¥åº·ä¸ä½³æ‹–ç´¯å¿ƒç†çŠ¶æ€ï¼</span>"; gameState.stats.resistance -= 1; gameState.gpa -= 0.05; }
    record.statsAfter = {...gameState.stats}; record.gpaAfter = gameState.gpa; record.result = resultText; gameState.history.push(record);
    if (!gameState.yearSummary[gameState.year]) gameState.yearSummary[gameState.year] = []; gameState.yearSummary[gameState.year].push(record); updateGameUI();
    const compView = document.getElementById('comparison-view'), compGrid = document.getElementById('comparison-grid'); compView.classList.remove('hidden');
    let checkHtml = ''; if (choice.check) { const have = record.statsBefore[choice.check.stat], req = choice.check.val; checkHtml = `<div class="p-2 bg-slate-800 rounded">è¦æ±‚: ${STATS[choice.check.stat].name} â‰¥ ${req}</div><div class="p-2 ${have >= req ? 'text-green-400' : 'text-red-400'} font-bold">ä½ çš„æ•°å€¼: ${have}</div><div class="p-2 font-bold">${have >= req ? 'âœ“ æˆåŠŸ' : 'âœ— å¤±è´¥'}</div>`; } else checkHtml = `<div class="col-span-3 p-2 text-slate-400">å®‰å…¨é€‰æ‹©ï¼Œæ— é£é™©åˆ¤å®š</div>`;
    compGrid.innerHTML = `<div class="col-span-3 text-left text-sm mb-2 border-b border-slate-700 pb-1 text-white">${resultText}</div>${checkHtml}`;
    document.getElementById('choices-container').innerHTML = `<button onclick="nextEvent()" class="w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold rounded-lg shadow-lg transition transform hover:scale-105">ç»§ç»­ â”</button>`;
}

function nextEvent() { gameState.currentEventIndex++; loadNextEvent(); }

function takeRest() {
    if (gameState.restUsed) { alert('æœ¬å­¦å¹´å·²ç»ä½¿ç”¨è¿‡ä¼‘æ•´æœºä¼šï¼'); return; }
    displayEvent({ id: 'rest_event', title: 'ğŸ›Œ ç”³è¯·ç—…å‡/ä¼‘æ•´', tag: 'ä¼‘æ•´æœŸ', desc: 'ä½ å‘å­¦é™¢ç”³è¯·äº†çŸ­æœŸä¼‘æ•´ã€‚è¿™æ®µæ—¶é—´ä½ è¿œç¦»äº†è¯¾ä¸šå‹åŠ›ï¼Œä¸“å¿ƒè°ƒå…»èº«ä½“ã€‚', choices: [ { text: 'å½»åº•æ”¾æ¾ï¼Œå®Œå…¨ä¼‘æ¯', effects: { health: 4, resistance: 3, focus: -2, social: -1 }, special: 'rest' }, { text: 'é€‚åº¦ä¼‘æ¯ï¼Œä¿æŒå­¦ä¹ ', effects: { health: 2, resistance: 2, focus: 1 } }, { text: 'å–æ¶ˆç”³è¯·ï¼Œç»§ç»­ç¡¬æ’‘', effects: { resistance: -2, health: -1 } } ] });
}

function confirmDropout() { if (confirm('ç¡®å®šè¦ç”³è¯·ä¼‘å­¦/é€€å­¦å—ï¼Ÿè¿™å°†ç»“æŸå½“å‰æ¸¸æˆã€‚')) displayEvent({ id: 'dropout', title: 'ğŸšª é€€å­¦å†³å®š', tag: 'é‡å¤§å†³å®š', desc: 'ç»è¿‡æ·±æ€ç†Ÿè™‘ï¼Œä½ å†³å®šæš‚æ—¶ç¦»å¼€æ ¡å›­ã€‚è¿™å¹¶ä¸æ˜¯ç»ˆç‚¹ï¼Œè€Œæ˜¯å¦ä¸€ç§äººç”Ÿçš„å¼€å§‹ã€‚', choices: [ { text: 'ç¡®è®¤é€€å­¦ï¼Œç»“æŸå­¦ä¸š', finalCheck: true } ] }); }

function showYearSummary(year) {
    document.getElementById('screen-gameplay').classList.add('hidden'); document.getElementById('screen-year-summary').classList.remove('hidden');
    document.getElementById('summary-year-title').innerText = `å¤§${['ä¸€','äºŒ','ä¸‰','å››'][year-1]}å­¦å¹´æ€»ç»“`; document.getElementById('summary-year-subtitle').innerText = `${gameState.major.name} - ${gameState.major.category}`;
    const yearRecords = gameState.yearSummary[year] || [], statChanges = { focus: 0, talent: 0, health: 0, social: 0, resistance: 0 };
    if (yearRecords.length > 0) { const first = yearRecords[0].statsBefore, last = yearRecords[yearRecords.length - 1].statsAfter || gameState.stats; Object.keys(statChanges).forEach(key => { statChanges[key] = (last[key] || 0) - (first[key] || 0); }); }
    document.getElementById('summary-stats-change').innerHTML = Object.keys(statChanges).map(key => { const change = statChanges[key], color = change > 0 ? 'text-green-400' : (change < 0 ? 'text-red-400' : 'text-slate-400'), arrow = change > 0 ? 'â†‘' : (change < 0 ? 'â†“' : '-'); return `<div class="flex justify-between"><span>${STATS[key].name}</span><span class="${color}">${arrow} ${Math.abs(change)}</span></div>`; }).join('');
    document.getElementById('summary-key-events').innerHTML = yearRecords.slice(-3).map(r => `<div class="p-2 bg-slate-800 rounded border-l-2 border-blue-500"><div class="font-bold text-white text-xs">${r.event}</div><div class="text-slate-400 text-xs mt-1">é€‰æ‹©: ${r.choice.substring(0, 20)}...</div></div>`).join('') || '<div class="text-slate-500">æœ¬å­¦å¹´æš‚æ— é‡å¤§äº‹ä»¶è®°å½•</div>';
    const s = gameState.stats, advices = [];
    if (s.health < 4) advices.push('âš ï¸ <b>å¥åº·é¢„è­¦</b>ï¼šå¥åº·çŠ¶å†µä¸ä½³ï¼Œå»ºè®®å‡å°‘ç†¬å¤œï¼Œå¢åŠ è¿åŠ¨ã€‚'); if (s.resistance < 4) advices.push('ğŸ›¡ï¸ <b>æŠ—å‹æé†’</b>ï¼šæŠ—å‹å€¼è¿‡ä½ï¼Œå®¹æ˜“å´©æºƒï¼Œå»ºè®®é€šè¿‡ç¤¾äº¤ã€ä¼‘æ¯æ¢å¤å¿ƒç†éŸ§æ€§ã€‚'); if (s.gpa < 2.5) advices.push('ğŸ“š <b>å­¦ä¸šæé†’</b>ï¼šGPAåä½ï¼Œéœ€è¦æŠ•å…¥æ›´å¤šæ—¶é—´å­¦ä¹ ã€‚'); if (s.social < 3) advices.push('ğŸ‘¥ <b>ç¤¾äº¤å»ºè®®</b>ï¼šç¤¾äº¤åœˆè¾ƒçª„ï¼Œå¯ä»¥å°è¯•å‚åŠ ç¤¾å›¢æˆ–å°ç»„æ´»åŠ¨ã€‚');
    if (advices.length === 0) { if (s.focus > 6 && s.gpa > 3.0) advices.push('ğŸ¯ <b>ä¼˜åŠ¿å‘å±•</b>ï¼šä¸“æ³¨åº¦å¾ˆé«˜ï¼Œå¯ä»¥è€ƒè™‘å‚ä¸ç§‘ç ”é¡¹ç›®æˆ–å‡†å¤‡æ·±é€ ã€‚'); if (s.talent > 6) advices.push('âœ¨ <b>ç‰¹é•¿å‘æŒ¥</b>ï¼šç‰¹é•¿çªå‡ºï¼Œå»ºè®®å‚åŠ ç›¸å…³ç«èµ›æˆ–å±•ç¤ºæ´»åŠ¨ã€‚'); if (s.social > 6) advices.push('ğŸŒŸ <b>äººè„‰èµ„æº</b>ï¼šç¤¾äº¤èƒ½åŠ›å¼ºï¼Œå¯ä»¥åˆ©ç”¨äººè„‰å¯»æ‰¾å®ä¹ æˆ–åˆä½œæœºä¼šã€‚'); }
    advices.push({1: 'ğŸ’¡ <b>å¤§ä¸€è§„åˆ’</b>ï¼šæ‰“å¥½åŸºç¡€ï¼Œæ¢ç´¢å…´è¶£ï¼Œå»ºç«‹è‰¯å¥½çš„å­¦ä¹ ä¹ æƒ¯å’Œç¤¾äº¤åœˆã€‚', 2: 'ğŸ’¡ <b>å¤§äºŒè§„åˆ’</b>ï¼šæ·±åŒ–ä¸“ä¸šå­¦ä¹ ï¼Œå¼€å§‹è€ƒè™‘æœªæ¥æ–¹å‘ï¼ˆè€ƒç ”/å°±ä¸š/å‡ºå›½ï¼‰ã€‚', 3: 'ğŸ’¡ <b>å¤§ä¸‰è§„åˆ’</b>ï¼šè¿™æ˜¯å…³é”®å¹´ï¼ç¡®å®šå‘å±•æ–¹å‘ï¼Œç§¯ç´¯å®ä¹ æˆ–ç§‘ç ”ç»å†ã€‚', 4: 'ğŸ’¡ <b>å¤§å››è§„åˆ’</b>ï¼šå®Œæˆæ¯•ä¸šè®¾è®¡ï¼Œè½å®å°±ä¸šæˆ–å‡å­¦ï¼Œåšå¥½èº«ä»½è½¬æ¢å‡†å¤‡ã€‚'}[year]);
    document.getElementById('summary-advice').innerHTML = advices.join('<br><br>');
}

function nextYear() { gameState.restUsed = false; document.getElementById('screen-year-summary').classList.add('hidden'); document.getElementById('screen-gameplay').classList.remove('hidden'); loadNextEvent(); }

function gameOverByAttribute(depletedStat) {
    document.getElementById('screen-gameplay').classList.add('hidden');
    document.getElementById('screen-year-summary').classList.add('hidden');
    document.getElementById('screen-ending').classList.remove('hidden');
    document.getElementById('screen-ending').classList.add('fade-in');

    const s = gameState.stats;
    const statNames = { focus: 'ä¸“æ³¨åº¦', talent: 'ç‰¹é•¿', health: 'å¥åº·å€¼', social: 'ç¤¾äº¤åŠ›', resistance: 'æŠ—å‹å€¼' };
    const statColors = { focus: 'text-blue-400', talent: 'text-purple-400', health: 'text-green-400', social: 'text-pink-400', resistance: 'text-red-400' };

    document.getElementById('end-title').innerText = 'ğŸ’” å¤§å­¦ä¹‹è·¯ä¸­æ–­';
    document.getElementById('end-desc').innerHTML = `ç”±äºä½ çš„<span class="${statColors[depletedStat]}">${statNames[depletedStat]}</span>è€—å°½ï¼Œä½ æ— æ³•ç»§ç»­å­¦ä¸šï¼Œè¢«è¿«æš‚æ—¶ç¦»å¼€äº†å¤§å­¦æ ¡å›­ã€‚`;
    document.getElementById('end-summary').innerText = `åœ¨ç¬¬${gameState.year}å­¦å¹´ç¬¬${gameState.semester % 2 + 1}å­¦æœŸï¼Œä½ çš„${statNames[depletedStat]}é™è‡³0ï¼Œæ— æ³•åº”å¯¹å¤§å­¦ç”Ÿæ´»çš„æŒ‘æˆ˜ã€‚è¿™æé†’æˆ‘ä»¬è¦å¹³è¡¡å‘å±•ï¼Œå…³æ³¨èº«å¿ƒå¥åº·ã€‚`;

    // æ›´æ–°5ç»´å±æ€§æ˜¾ç¤ºï¼ˆå¼ºåˆ¶é€€å‡ºæ—¶æ˜¾ç¤ºå®é™…æ•°å€¼è€Œéè¯„çº§ï¼‰
    document.getElementById('end-focus').innerText = s.focus;
    document.getElementById('end-talent').innerText = s.talent;
    document.getElementById('end-health').innerText = s.health;
    document.getElementById('end-social').innerText = s.social;
    document.getElementById('end-resistance').innerText = s.resistance;
    // è®¡ç®—å½“å‰æ€»å€¼ï¼ˆå¼ºåˆ¶é€€å‡ºæ—¶ï¼‰
    const totalScore = Object.values(s).reduce((a,b) => a+b, 0);
    document.getElementById('end-total').innerText = totalScore + " (æœªå®Œæˆ)";
    document.getElementById('end-rating').innerText = "âš ï¸ å­¦ä¸šä¸­æ–­";

    // ç»˜åˆ¶é›·è¾¾å›¾ï¼Œä½†æ ‡è®°å‡ºç¼ºå¤±çš„å±æ€§
    new Chart(document.getElementById('radarChart').getContext('2d'), { 
        type: 'radar', 
        data: { 
            labels: Object.values(STATS).map(s => s.name), 
            datasets: [{ 
                label: 'æœ€ç»ˆå±æ€§', 
                data: Object.keys(STATS).map(k => s[k]), 
                backgroundColor: 'rgba(239, 68, 68, 0.2)', 
                borderColor: '#ef4444', 
                pointBackgroundColor: '#fff', 
                pointBorderColor: '#ef4444' 
            }, { 
                label: 'åˆå§‹å±æ€§', 
                data: Object.keys(STATS).map(k => gameState.initialStats[k]), 
                backgroundColor: 'rgba(148, 163, 184, 0.1)', 
                borderColor: '#94a3b8', 
                borderDash: [5, 5], 
                pointBackgroundColor: '#94a3b8' 
            }] 
        }, 
        options: { 
            scales: { 
                r: { 
                    angleLines: { color: 'rgba(255, 255, 255, 0.1)' }, 
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }, 
                    pointLabels: { color: '#94a3b8' }, 
                    ticks: { display: false, backdropColor: 'transparent' }, 
                    suggestedMin: 0, 
                    suggestedMax: 12 
                } 
            }, 
            plugins: { 
                legend: { labels: { color: '#e2e8f0' } } 
            } 
        } 
    });
}

function endGame() {
    document.getElementById('screen-gameplay').classList.add('hidden'); document.getElementById('screen-year-summary').classList.add('hidden'); document.getElementById('screen-ending').classList.remove('hidden'); document.getElementById('screen-ending').classList.add('fade-in');
    const s = gameState.stats, gpa = gameState.gpa; let title = "å¹³å‡¡çš„å¤§å­¦æ¯•ä¸šç”Ÿ", desc = "ä½ å®Œæˆäº†å­¦ä¸šï¼Œæ²¡æœ‰ç•™ä¸‹å¤ªå¤šé—æ†¾ï¼Œä¹Ÿæ²¡æœ‰å¤ªå¤šå€¼å¾—å¹å˜˜çš„äº‹è¿¹ã€‚";
    if (gpa > 3.8 && s.health > 5 && s.resistance > 5) { title = "ğŸ† äººç”Ÿèµ¢å®¶"; desc = "ä½ ä¸ä»…æˆç»©ä¼˜å¼‚ï¼Œè€Œä¸”èº«å¿ƒå¥åº·ï¼Œæ˜¯æ‰€æœ‰äººç¾¡æ…•çš„å¯¹è±¡ã€‚"; } else if (gpa > 3.8) { title = "ğŸ“ å­¦éœ¸"; desc = "ä½ çš„æˆç»©é¡¶å°–ï¼Œä½†ä¸ºæ­¤ä»˜å‡ºäº†å¥åº·çš„ä»£ä»·ã€‚"; } else if (s.social > 8 && s.talent > 5) { title = "ğŸŒŸ ç¤¾å›¢è¾¾äºº"; desc = "ä½ åœ¨ç¤¾å›¢æ´»åŠ¨ä¸­å¦‚é±¼å¾—æ°´ï¼Œæœªæ¥çš„äººè„‰èµ„æºå¹¿é˜”ã€‚"; } else if (s.health < 2) { title = "ğŸ¥ å¸¦ç—…çš„æ¯•ä¸šç”Ÿ"; desc = "ç”±äºé•¿æœŸå¿½è§†å¥åº·ï¼Œä½ å‹‰å¼ºæ¯•ä¸šï¼Œæ€¥éœ€ä¼‘å…»ã€‚"; } else if (gpa < 2.0) { title = "ğŸ“‰ è‰°éš¾æ¯•ä¸š"; desc = "ä½ å‹‰å¼ºè¾¾åˆ°äº†æ¯•ä¸šè¦æ±‚ï¼Œä½†æœªæ¥é“è·¯å……æ»¡æŒ‘æˆ˜ã€‚"; } else if (s.focus > 7 && s.talent > 5) { title = "ğŸ”¬ å­¦æœ¯æ–°æ˜Ÿ"; desc = "ä½ å±•ç°äº†å‡ºè‰²çš„å­¦æœ¯æ½œåŠ›ï¼Œé€‚åˆç»§ç»­æ·±é€ ã€‚"; } else if (s.resistance < 3) { title = "ğŸ˜° ç–²æƒ«çš„æ¯•ä¸šç”Ÿ"; desc = "ä½ æ‰¿å—äº†å·¨å¤§çš„å¿ƒç†å‹åŠ›ï¼Œæ¯•ä¸šåéœ€è¦å¥½å¥½è°ƒæ•´ã€‚"; }
    const achievements = []; if (gpa > 3.5) achievements.push(`ä¿æŒé«˜GPA(${gpa.toFixed(2)})`); if (s.social > 6) achievements.push('å»ºç«‹å¹¿æ³›äººè„‰'); if (s.talent > 6) achievements.push('å‘å±•çªå‡ºç‰¹é•¿'); if (s.health > 6) achievements.push('ä¿æŒè‰¯å¥½å¥åº·'); if (s.focus > 6) achievements.push('é«˜åº¦ä¸“æ³¨å­¦ä¹ '); if (s.resistance > 6) achievements.push('å…·å¤‡å¼ºå¤§æŠ—å‹èƒ½åŠ›');
    document.getElementById('end-title').innerText = title; document.getElementById('end-desc').innerText = desc;
    // æ›´æ–°5ç»´å±æ€§è¯„ä»·
    document.getElementById('end-focus').innerText = s.focus > 6 ? "å“è¶Š" : (s.focus < 3 ? "è–„å¼±" : "è‰¯å¥½");
    document.getElementById('end-talent').innerText = s.talent > 6 ? "å‡ºä¼—" : (s.talent < 3 ? "å¹³åº¸" : "ä¸€èˆ¬");
    document.getElementById('end-health').innerText = s.health > 5 ? "å¥åº·" : (s.health < 3 ? "å ªå¿§" : "ä¸€èˆ¬");
    document.getElementById('end-social').innerText = s.social > 6 ? "ç¤¾ç‰›" : (s.social < 3 ? "ç¤¾æ" : "æ™®é€š");
    document.getElementById('end-resistance').innerText = s.resistance > 6 ? "åšéŸ§" : (s.resistance < 3 ? "è„†å¼±" : "æ­£å¸¸");
    // è®¡ç®—å¹¶æ˜¾ç¤ºå±æ€§æ€»å€¼
    const totalScore = Object.values(s).reduce((a,b) => a+b, 0);
    document.getElementById('end-total').innerText = totalScore;
    // æ ¹æ®æ€»å€¼ç»™å‡ºç»¼åˆè¯„çº§
    let rating = "";
    if (totalScore >= 35) rating = "â­â­â­â­â­ ä¼ å¥‡å¤§å­¦ç”Ÿ";
    else if (totalScore >= 30) rating = "â­â­â­â­ ä¼˜ç§€æ¯•ä¸šç”Ÿ";
    else if (totalScore >= 25) rating = "â­â­â­ åˆæ ¼æ¯•ä¸šç”Ÿ";
    else if (totalScore >= 20) rating = "â­â­ å‹‰å¼ºæ¯•ä¸š";
    else rating = "â­ è‰°éš¾æ±‚ç”Ÿ";
    document.getElementById('end-rating').innerText = rating;
    document.getElementById('end-summary').innerText = achievements.length > 0 ? `å››å¹´é‡Œï¼Œä½ ${achievements.join('ã€')}ã€‚æœ€ç»ˆå±æ€§æ€»å’Œä¸º${Object.values(s).reduce((a,b) => a+b, 0)}ç‚¹ã€‚` : `å››å¹´æ—¶å…‰å¹³æ·¡åº¦è¿‡ï¼Œæœ€ç»ˆå±æ€§æ€»å’Œä¸º${Object.values(s).reduce((a,b) => a+b, 0)}ç‚¹ã€‚`;
    new Chart(document.getElementById('radarChart').getContext('2d'), { type: 'radar', data: { labels: Object.values(STATS).map(s => s.name), datasets: [{ label: 'æœ€ç»ˆå±æ€§', data: Object.keys(STATS).map(k => s[k]), backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: '#3b82f6', pointBackgroundColor: '#fff', pointBorderColor: '#3b82f6' }, { label: 'åˆå§‹å±æ€§', data: Object.keys(STATS).map(k => gameState.initialStats[k]), backgroundColor: 'rgba(148, 163, 184, 0.1)', borderColor: '#94a3b8', borderDash: [5, 5], pointBackgroundColor: '#94a3b8' }] }, options: { scales: { r: { angleLines: { color: 'rgba(255, 255, 255, 0.1)' }, grid: { color: 'rgba(255, 255, 255, 0.1)' }, pointLabels: { color: '#94a3b8' }, ticks: { display: false, backdropColor: 'transparent' }, suggestedMin: 0, suggestedMax: 12 } }, plugins: { legend: { labels: { color: '#e2e8f0' } } } } });
}

function exportLog() {
    let logContent = `====== å¤§å­¦äººç”Ÿæ¨¡æ‹Ÿè®°å½• ======\nå­¦ç§‘é—¨ç±»: ${gameState.major.name}\næœ€ç»ˆGPA: ${gameState.gpa.toFixed(2)}\næ€»å±æ€§å˜åŒ–: ${Object.keys(gameState.stats).map(k => `${STATS[k].name}: ${gameState.initialStats[k]}â†’${gameState.stats[k]}`).join(', ')}\näº‹ä»¶è§¦å‘ç»Ÿè®¡: ${Object.entries(gameState.eventCounts).map(([id, count]) => `${id}:${count}`).join(', ')}\n--------------------------`;
    let currentYear = 0; gameState.history.forEach(entry => { if (entry.year !== currentYear) { currentYear = entry.year; logContent += `\n\n===== å¤§${['ä¸€','äºŒ','ä¸‰','å››'][currentYear-1]}å­¦å¹´ =====\n`; } logContent += `\n[${entry.semester}] ${entry.event}\né€‰æ‹©: ${entry.choice}\n`; if (entry.result) logContent += `ç»“æœ: ${entry.result.replace(/<[^>]*>/g, '')}\n`; logContent += `GPAå˜åŒ–: ${entry.gpaBefore.toFixed(2)} â†’ ${(entry.gpaAfter || entry.gpaBefore).toFixed(2)}\n`; });
    const blob = new Blob([logContent], { type: 'text/plain;charset=utf-8' }), url = URL.createObjectURL(blob), a = document.createElement('a'); a.href = url; a.download = `å¤§å­¦æ¨¡æ‹Ÿè®°å½•_${gameState.major.name}_${new Date().toLocaleDateString()}.txt`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
}

init();
</script>
</body>
</html>